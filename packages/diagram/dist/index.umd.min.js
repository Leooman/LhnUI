!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("vue"));else if("function"==typeof define&&define.amd)define(["vue"],e);else{var i="object"==typeof exports?e(require("vue")):e(t.vue);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,(function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=7)}([function(t,e,i){window,t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function o(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}i.r(e),i.d(e,"uuid",(function(){return o}))}])},function(e,i){e.exports=t},function(t,e,i){var n=i(4),o=i(5);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var r={insert:"head",singleton:!1};n(o,r);t.exports=o.locals||{}},function(t,e,i){"use strict";i.r(e),i.d(e,"Diagram",(function(){return st}));var n={fontColor:"#000000",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"left",textBaseline:"top",textRectFill:"#ffffff",textRectStroke:"#000000",textRectActiveStroke:"#E79D32",lineMode:1,lineJoin:"miter",lineWidth:2,lineStroke:"#000000",lineActiveStroke:"#E79D32",arrowFill:"#000000",arrowStroke:"#000000",arrowActiveFill:"#E79D32",arrowActiveStroke:"#E79D32",defaultLineName:"polyline",defaultFromArrowType:"",defaultToArrowType:"triangleSolid",tableName:"双击可修改名称",tableDefaultW:100,tableDefaultH:100,tableHandle:1,tableNodeFill:"#ffffff",tableNodeStroke:"#c1c7cd",tableNodeBorderColor:"#0C64EB",tablePadding:10,tableTitleFill:"#e1e7ed",tableGroupTitleFill:"#d0e2ff",tablePrimarykeyFill:"#fffaf1",anchorRadius:5,anchorFill:"#ffffff",anchorStroke:"#ff0000",resizerStroke:"#0C64EB",resizerFill:"#ffffff",resizerWidth:10,resizerCursors:["nw-resize","ne-resize","se-resize","sw-resize"]},o=i(0),r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function a(t,e){var i,n;if(e.length<3)return!1;var o=!1,a=e[e.length-1];try{for(var s=r(e),c=s.next();!c.done;c=s.next()){var l=c.value;(l.y<t.y&&a.y>=t.y||l.y>=t.y&&a.y<t.y)&&l.x+(t.y-l.y)*(a.x-l.x)/(a.y-l.y)>t.x&&(o=!o),a=l}}catch(t){i={error:t}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function s(t,e,i){return a(t,[new P(e.x-8,e.y-8),new P(i.x-8,i.y-8),new P(i.x+8,i.y+8),new P(e.x+8,e.y+8)])}var c=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function l(t,e){var i,o;t.strokeStyle=e.active?n.lineActiveStroke:n.lineStroke,t.beginPath(),t.moveTo(e.from.x,e.from.y);try{for(var r=c(e.controlPoints),a=r.next();!a.done;a=r.next()){var s=a.value;t.lineTo(s.x,s.y)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}t.lineTo(e.to.x,e.to.y),t.stroke()}function h(t,e){t.save(),t.fillStyle="#fff",t.strokeStyle=e.active?n.lineActiveStroke:n.lineStroke,t.lineWidth=2,u(t,e.from),u(t,e.to),t.restore()}function u(t,e){t.beginPath(),t.arc(e.x,e.y,n.anchorRadius,0,2*Math.PI),t.stroke(),t.fill()}function f(t){t.controlPoints=[];var e=y(t.from,t.to);void 0!==t.from.direction&&t.controlPoints.push(e);var i=y(t.to,t.from),n=[];switch(e.direction){case g.Up:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y>e.y)return e.direction===g.Up&&t.y-e.y>150?t.x<e.x?e.x-t.x<50?[new P(t.x-100,t.y),new P(t.x-100,e.y)]:[new P(t.x,e.y)]:t.x-e.x<50?[new P(t.x+100,t.y),new P(t.x+100,e.y)]:[new P(t.x,e.y)]:e.direction===g.Left&&t.x>e.x||e.direction===g.Right&&t.x<e.x?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===g.Bottom){if(t.x<e.x)return p(t,e);var i=p(e,t);return[i[1],i[0]]}return[new P(e.x,t.y)]}(e,i);break;case g.Right:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x<e.x)return e.direction===g.Right&&e.x-t.x>150?t.y<e.y?e.y-t.y<50?[new P(t.x,t.y-100),new P(e.x,t.y-100)]:[new P(e.x,t.y)]:t.y-e.y<50?[new P(t.x,t.y+100),new P(e.x,t.y+100)]:[new P(e.x,t.y)]:e.direction===g.Right||e.direction===g.Up&&t.y<e.y||e.direction===g.Bottom&&t.y>e.y?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===g.Left){if(t.y<e.y)return x(t,e);var i=x(e,t);return[i[1],i[0]]}return[new P(t.x,e.y)]}(e,i);break;case g.Bottom:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y<e.y)return e.direction===g.Bottom&&e.y-t.y>150?t.x<e.x?e.x-t.x<50?[new P(t.x-100,t.y),new P(t.x-100,e.y)]:[new P(t.x,e.y)]:t.x-e.x<50?[new P(t.x+100,t.y),new P(t.x+100,e.y)]:[new P(t.x,e.y)]:e.direction===g.Left&&t.x>e.x||e.direction===g.Right&&t.x<e.x?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===g.Up){if(t.x<e.x)return p(t,e);var i=p(e,t);return[i[1],i[0]]}return[new P(e.x,t.y)]}(e,i);break;case g.Left:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x>e.x)return e.direction===g.Left&&t.x-e.x>150?t.y<e.y?e.y-t.y<50?[new P(t.x,t.y+100),new P(e.x,t.y+100)]:[new P(e.x,t.y)]:t.y-e.y<50?[new P(t.x,t.y-100),new P(e.x,t.y-100)]:[new P(e.x,t.y)]:e.direction===g.Left||e.direction===g.Up&&t.y<e.y||e.direction===g.Bottom&&t.y>e.y?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===g.Right){if(t.y<e.y)return x(t,e);var i=x(e,t);return[i[1],i[0]]}return[new P(t.x,e.y)]}(e,i)}t.controlPoints.push.apply(t.controlPoints,n),void 0!==t.to.direction&&t.controlPoints.push(i)}function d(t,e){if(!e.controlPoints||!e.controlPoints.length)return s(t,e.from,e.to);if(s(t,e.from,e.controlPoints[0]))return!0;if(s(t,e.to,e.controlPoints[e.controlPoints.length-1]))return!0;for(var i=0;i<e.controlPoints.length-1;++i)if(s(t,e.controlPoints[i],e.controlPoints[i+1]))return!0;return!1}function y(t,e){var i=t.clone();switch(t.direction){case g.Up:e.y<t.y?i.y-=Math.floor((t.y-e.y)/2):i.y-=50;break;case g.Right:e.x>t.x?i.x+=Math.floor((e.x-t.x)/2):i.x+=50;break;case g.Bottom:e.y>t.y?i.y+=Math.floor((e.y-t.y)/2):i.y+=50;break;case g.Left:e.x<t.x?i.x-=Math.floor((t.x-e.x)/2):i.x-=50}return i}function p(t,e){var i=t.x+(e.x-t.x)/2;return[new P(i,t.y),new P(i,e.y)]}function x(t,e){var i=t.y+(e.y-t.y)/2;return[new P(t.x,i),new P(e.x,i)]}function v(t,e,i,n,o){n+=3*t.lineWidth;var r=t.lineWidth/10;t.lineWidth<2&&(t.lineWidth=2,r=0),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x-t.lineWidth+5*r,-i.y),t.moveTo(i.x,i.y+r),t.lineTo(i.x,i.y-r),t.lineTo(i.x-n,i.y-n/3),t.lineTo(i.x-n,i.y+n/3),t.closePath(),t.stroke(),o&&(t.fillStyle=o),t.fill()}function m(t,e,i,n){v(t,e,i,n,"#fff")}var w={},b={};w.polyline={drawFn:l,controlPointsFn:f,drawEndPointsFn:h,pointIn:d},b.triangleSolid=v,b.triangle=m;var g,L,R,N,P=function(){function t(t,e,i,n,o,r){void 0===r&&(r=0),this.x=t,this.y=e,this.direction=i,this.id=n,this.hidden=o,this.anchorIndex=r,this.id=n,this.direction=i,this.anchorIndex=i||0,this.hidden=o||!1}return t.prototype.clone=function(){return new t(this.x,this.y,this.direction)},t.prototype.floor=function(){this.x|=0,this.y|=0},t.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},t.prototype.hit=function(t,e){return void 0===e&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},t.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,n=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=n,this},t.prototype.getLinkNode=function(t){var e=this;return t.find((function(t){return t.key===e.id}))},t.prototype.updateDirection=function(t){this.direction=t,this.anchorIndex=t},t}(),S=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},C=function(){function t(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n,this.center=new P(0,0),i<0&&(i=0),n<0&&(n=0),this.init()}return t.prototype.init=function(){this.ex=this.x+this.w,this.ey=this.y+this.h,this.calcCenter()},t.prototype.floor=function(){this.x|=0,this.y|=0,this.w|=0,this.h|=0,this.init()},t.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y),this.w=Math.round(this.w),this.h=Math.round(this.h),this.init()},t.prototype.clone=function(){return new t(this.x,this.y,this.w,this.h)},t.prototype.hit=function(t,e){return void 0===e&&(e=0),t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},t.prototype.hitByRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},t.prototype.hitRotate=function(t,e,i){var n,o,r=this.toPoints();try{for(var s=S(r),c=s.next();!c.done;c=s.next()){c.value.rotate(e,i)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}return a(t,r)},t.prototype.calcCenter=function(){this.center.x=this.x+this.w/2,this.center.y=this.y+this.h/2},t.prototype.toPoints=function(){return[new P(this.x,this.y),new P(this.ex,this.y),new P(this.ex,this.ey),new P(this.x,this.ey)]},t.prototype.translate=function(t,e){this.x+=t,this.y+=e,this.ex+=t,this.ey+=e,this.calcCenter()},t.prototype.scale=function(t,e,i){e||(e=this.center),void 0===i&&(i=t),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*i,this.w*=t,this.h*=i,this.init()},t}();!function(t){t[t.Up=0]="Up",t[t.Right=1]="Right",t[t.Bottom=2]="Bottom",t[t.Left=3]="Left"}(g||(g={})),function(t){t[t.LeftTop=0]="LeftTop",t[t.RightTop=1]="RightTop",t[t.RightBottom=2]="RightBottom",t[t.LeftBottom=3]="LeftBottom"}(L||(L={})),function(t){t[t.ANCHOR=0]="ANCHOR",t[t.HANDLER=1]="HANDLER"}(R||(R={})),function(t){t[t.COLLAPSE=0]="COLLAPSE",t[t.SWITCH=1]="SWITCH"}(N||(N={}));var A,k=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},T=function(){function t(t){var e,i;if(this.controlPoints=[],this.fromArrowSize=5,this.toArrowSize=5,this.active=!1,this.animatePos=0,this.isAnimate=!1,this.animateFromSize=0,this.animateToSize=0,t){if(t.from&&(this.from=t.from),t.to&&(this.to=t.to),this.id=t.id||Object(o.uuid)(),this.name=t.name||n.defaultLineName,this.fromArrow=t.fromArrow||n.defaultFromArrowType,this.toArrow=t.toArrow||n.defaultToArrowType,this.calcControlPoints(),t.controlPoints)try{for(var r=k(t.controlPoints),a=r.next();!a.done;a=r.next()){var s=a.value;this.controlPoints.push(new P(s.x,s.y,s.direction))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}this.animateColor=t.animateColor||"",this.animateSpan=t.animateSpan||1,this.text=t.text}else this.name=n.defaultLineName,this.fromArrow=n.defaultToArrowType}return t.prototype.calcTextRect=function(){var t=this.getCenter(),e=n.lineHeight*n.fontSize;this.textRect=new C(t.x-25,t.y-e/2,50,e)},t.prototype.getTextRect=function(){return this.textRect||this.calcTextRect(),this.textRect},t.prototype.pointIn=function(t){return w[this.name].pointIn(t,this)},t.prototype.toTextPoints=function(){return!!this.textRect&&[new P(this.textRect.x,this.textRect.y),new P(this.textRect.x+this.textRect.w,this.textRect.y),new P(this.textRect.x+this.textRect.w,this.textRect.y+this.textRect.h),new P(this.textRect.x,this.textRect.y+this.textRect.h)]},t.prototype.getCenter=function(){var t=new P(this.from.x,this.from.y),e=Math.floor(this.controlPoints.length/2);switch(this.name){case"polyline":t=this.getLineCenter(this.controlPoints[e-1],this.controlPoints[e])}return t},t.prototype.getLineCenter=function(t,e){return new P((t.x+e.x)/2,(t.y+e.y)/2)},t.prototype._drawText=function(t){this.getTextRect(),t&&this.text&&this.textRect&&(t.save(),t.fillStyle=n.textRectFill,t.strokeStyle=this.active?n.textRectActiveStroke:n.textRectStroke,t.fillRect(this.textRect.x,this.textRect.y,this.textRect.w,this.textRect.h),t.strokeRect(this.textRect.x,this.textRect.y,this.textRect.w,this.textRect.h),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(this.text,this.textRect.x+(this.textRect.w-t.measureText(this.text).width)/2,this.textRect.y+(this.textRect.h-n.fontSize)/2),t.restore())},t.prototype.calcControlPoints=function(){this.from&&this.to&&w[this.name]&&w[this.name].controlPointsFn(this)},t.prototype.draw=function(t){n.lineMode===R.HANDLER&&this.calcControlPoints(),this.isAnimate||(t.save(),t.lineJoin=n.lineJoin,t.lineWidth=n.lineWidth,w[this.name]&&w[this.name].drawFn(t,this),t.restore());if(this.fromArrow&&b[this.fromArrow]){t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.active?n.arrowActiveFill:n.arrowFill,t.strokeStyle=this.active?n.arrowActiveStroke:n.arrowStroke;var e=this.to;e=this.controlPoints[0],b[this.fromArrow](t,e,this.from,1*this.fromArrowSize),t.restore()}if(this.toArrow&&b[this.toArrow]){t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.active?n.arrowActiveFill:n.arrowFill,t.strokeStyle=this.active?n.arrowActiveStroke:n.arrowStroke;e=this.from;e=this.controlPoints[this.controlPoints.length-1],b[this.toArrow](t,e,this.to,1*this.toArrowSize),t.restore()}n.lineMode===R.HANDLER&&this.active&&w[this.name].drawEndPointsFn(t,this),this.text&&!this.isAnimate&&(this.calcTextRect(),this._drawText(t))},t.prototype.getLineToDirection=function(t){var e=this.controlPoints[this.controlPoints.length-1];return t.y>e.y?g.Up:t.y<e.y?g.Bottom:t.x>e.x?g.Left:t.x<e.x?g.Right:void 0},t.prototype.hidden=function(t){var e=this,i=t.find((function(t){return t.key===e.from.id})),n=t.find((function(t){return t.key===e.to.id}));return!(!(null==i?void 0:i.table.hidden)&&!(null==n?void 0:n.table.hidden))},t.prototype.getPointByPos=function(t){var e,i;if(t<=0)return this.from;switch(this.name){case"polyline":if(this.controlPoints&&this.controlPoints.length){var n=this.controlPoints.concat(this.to),o=this.from;try{for(var r=k(n),a=r.next();!a.done;a=r.next()){var s=a.value,c=this.lineLen(o,s);if(!(t>c))return this.getLinePtByPos(o,s,t);t-=c,o=s}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return this.to}return this.getLinePtByPos(this.from,this.to,t)}return null},t.prototype.getLinePtByPos=function(t,e,i){var n=this.lineLen(t,e);if(i<=0)return t;if(i>=n)return e;var o=t.x+(e.x-t.x)*(i/n),r=t.y+(e.y-t.y)*(i/n);return new P(o,r)},t.prototype.round=function(){this.from.round(),this.to.round()},t.prototype.lineLen=function(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},t.prototype.translate=function(t,e){var i,n;this.from.x+=t,this.from.y+=e,this.to.x+=t,this.to.y+=e;try{for(var o=k(this.controlPoints),r=o.next();!r.done;r=o.next()){var a=r.value;a.x+=t,a.y+=e}}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},t.prototype.updateEndPoints=function(t){this.from=this.updateEndPoint(t,this.from),this.to=this.updateEndPoint(t,this.to),this.calcControlPoints()},t.prototype.updateEndPoint=function(t,e){var i=t.find((function(t){return t.key===e.id}));return i?i.anchors[e.anchorIndex]:e},t.prototype._calcPosition=function(t,e,i){var n=e.toRect();t.direction===g.Bottom||t.direction===g.Up?(t.x+=i.x,t.x>n.ex&&(t.x=n.ex,t.y=n.y+n.h/2,t.updateDirection(g.Right)),t.x<n.x&&(t.x=n.x,t.y=n.y+n.h/2,t.updateDirection(g.Left))):(t.y+=i.y,t.y>n.ey&&(t.y=n.ey,t.x=n.x+n.w/2,t.updateDirection(g.Bottom)),t.y<n.y&&(t.y=n.y,t.x=n.x+n.w/2,t.updateDirection(g.Up)))},t.prototype.lineMove=function(t,e,i){this._calcPosition(this.from,t,i),this._calcPosition(this.to,e,i)},t.prototype.lineEndMove=function(t,e,i){var n=e.toRect();t.direction===g.Bottom||t.direction===g.Up?(t.x+=i.x,t.x>n.ex&&(t.x=n.ex,t.updateDirection(g.Right)),t.x<n.x&&(t.x=n.x,t.updateDirection(g.Left))):(t.y+=i.y,t.y>n.ey&&(t.y=n.ey,t.updateDirection(g.Bottom)),t.y<n.y&&(t.y=n.y,t.updateDirection(g.Up)))},t}(),O=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a},E=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(O(arguments[e]));return t},M=function(){function t(t){this.key=t.key,this.parent=t.parent,this.rect=t.rect,this.padding=t.padding||n.tablePadding,this.fontSize=t.fontSize||n.fontSize,this.table=t.table,this.table.collapse=t.table.collapse||!1,this.table.hidden=t.table.hidden||!1,this.table.name=t.table.name||n.tableName,this.table.titleRect=new C(this.rect.x+.5,this.rect.y+.5,this.table.isGroup?this.rect.w-(this.fontSize+2*this.padding):this.rect.w-.5,this.fontSize+2*this.padding),this.table.collapseRect=this.table.isGroup?new C(this.rect.x+this.rect.w-this.fontSize-2*this.padding,this.rect.y+.5,this.fontSize+2*this.padding,this.fontSize+2*this.padding):null,this.alias=t.alias||"",this.active=t.active||!1,this.anchors=t.anchors||this.calcAnchors()}return t.prototype.toPoints=function(){return[new P(this.rect.x,this.rect.y),new P(this.rect.x+this.rect.w,this.rect.y),new P(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h)),new P(this.rect.x,this.rect.y+(n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h))]},t.prototype.toRect=function(){return new C(this.rect.x,this.rect.y,this.rect.w,n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h)},t.prototype.translate=function(t,e){var i=this;this.rect.x+=t.x,this.rect.y+=t.y,this.calcAnchors(),n.lineMode===R.HANDLER&&e&&e.forEach((function(e){e.from.id===i.key&&(e.from.x+=t.x,e.from.y+=t.y),e.to.id===i.key&&(e.to.x+=t.x,e.to.y+=t.y)}))},t.prototype.calcResizer=function(){var t=[];return t.push(new P(this.rect.x,this.rect.y,L.LeftTop,this.key)),t.push(new P(this.rect.x+this.rect.w,this.rect.y,L.RightTop,this.key)),t.push(new P(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),L.RightBottom,this.key)),t.push(new P(this.rect.x,this.rect.y+(n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),L.LeftBottom,this.key)),t},t.prototype.hitResizer=function(t){if(this.active)return this.calcResizer().findIndex((function(e){return e.hit(t,n.resizerWidth/2)}))},t.prototype.resize=function(t,e,i){var o=this;if(!(this.table.collapse||this.rect.h<=this.table.titleRect.h)){switch(t){case L.LeftTop:this.rect.x+=e.x,this.rect.y+=e.y,this.rect.w-=e.x,this.rect.h-=e.y;break;case L.RightTop:this.rect.y+=e.y,this.rect.w+=e.x,this.rect.h-=e.y;break;case L.RightBottom:this.rect.w+=e.x,this.rect.h+=e.y;break;case L.LeftBottom:this.rect.x+=e.x,this.rect.w-=e.x,this.rect.h+=e.y}this.calcAnchors(),n.lineMode===R.HANDLER&&i&&i.forEach((function(t){t.from.id===o.key&&o._calcLinePosition(t.from),t.to.id===o.key&&o._calcLinePosition(t.to)}))}},t.prototype._calcLinePosition=function(t){t.direction!==g.Bottom&&t.direction!==g.Up||(t.y=t.direction===g.Bottom?this.rect.y+this.rect.h:this.rect.y,t.x<this.rect.x&&(t.x=this.rect.x),t.x>this.rect.x+this.rect.w&&(t.x=this.rect.x+this.rect.w)),t.direction!==g.Left&&t.direction!==g.Right||(t.x=t.direction===g.Left?this.rect.x:this.rect.x+this.rect.w,t.y<this.rect.y&&(t.y=this.rect.y),t.y>this.rect.y+this.rect.h&&(t.y=this.rect.y+this.rect.h))},t.prototype.calcAnchors=function(){return this.anchors=[],this.anchors.push(new P(this.rect.x+this.rect.w/2,this.rect.y,g.Up,this.key)),this.anchors.push(new P(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h/2:this.rect.h/2),g.Right,this.key)),this.anchors.push(new P(this.rect.x+this.rect.w/2,this.rect.y+(n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),g.Bottom,this.key)),this.anchors.push(new P(this.rect.x,this.rect.y+(n.tableHandle===N.COLLAPSE&&this.table.collapse?this.table.titleRect.h/2:this.rect.h/2),g.Left,this.key)),this.anchors},t.prototype.getChildNode=function(t){var e=this;return t.filter((function(t){return t.parent===e.key}))},t.prototype.getGenerations=function(t){var e=[],i=function(n){var o=n.getChildNode(t);o&&(e.push.apply(e,E(o)),o.forEach((function(t){return i(t)})))};return i(this),e},t.prototype.getParentNode=function(t){var e=this;return t.find((function(t){return t.key===e.parent}))},t.prototype.outBounds=function(t,e){var i=this.table.collapse?this.table.titleRect:this.rect,n=this.getParentNode(t);return!!n&&(i.x+i.w+e.x>=n.rect.x+n.rect.w||i.x+e.x<=n.rect.x||i.y+e.y<=n.rect.y+n.table.titleRect.h||i.y+i.h+e.y>=n.rect.y+n.rect.h)},t.prototype.updateNodeAnchorStatus=function(t){for(var e=0;e<this.anchors.length;++e)this.anchors[e].hidden=t},t}();!function(t){t.NONE="None",t.NODEHOVER="NodeHover",t.NODECLICK="NodeClick",t.NODERESIZE="NodeResize",t.NODEDBLCLICK="NodeDblClick",t.NODECOLLAPSE="NodeCollapse",t.ANCHORMATCH="AnchorMatch",t.LINECLICK="LineClick",t.LINECONTROLCLICK="LineControlClick",t.CANVASCLICK="CanvasClick"}(A||(A={}));var H={grid:!0,font:{color:n.fontColor,fontFamily:n.fontFamily,fontSize:n.fontSize,lineHeight:n.lineHeight,textAlign:n.textAlign,textBaseline:n.textBaseline}},_=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},D=function(){function t(t){var e,i,o,r;if(this.nodes=[],this.lines=[],t){this.nodes=[];try{for(var a=_(t.nodes),s=a.next();!s.done;s=a.next()){var c=s.value;this.nodes.push(new M(c))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}this.lines=[];try{for(var l=_(t.lines),h=l.next();!h.done;h=l.next()){!(c=h.value).from||c.from instanceof P||(c.from=this.translateLineOptionToPoint(this.nodes,c.from)),!c.to||c.to instanceof P||(c.to=this.translateLineOptionToPoint(this.nodes,c.to)),this.lines.push(new T(c))}}catch(t){o={error:t}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}this.lineName=t.lineName||n.defaultLineName,this.fromArrowType=t.fromArrowType||n.defaultFromArrowType,this.toArrowType=t.toArrowType||n.defaultToArrowType,this.scale=t.scale||1,this.locked=t.locked||0}}return t.prototype.translateLineOptionToPoint=function(t,e){var i=t.find((function(t){return t.key===e.id}));return i?i.anchors[e.anchorIndex]:e},t}();function j(t,e,i){var n=t.measureText(e).width,o=t.measureText("…").width;if(n<=i||i<=o)return e;for(var r=e.length;n>=i-o&&r-- >0;)e=e.slice(0,r),n=t.measureText(e).width;return e+"…"}function I(t,e){e.forEach((function(e){!e.table.hidden&&function(t,e){if(t){t.save();var i=Number(e.rect.w)||100,o=Number(e.rect.h)||50,r=Number(e.rect.x),a=Number(e.rect.y);t.strokeStyle=e.active?n.resizerStroke:n.tableNodeStroke,t.fillStyle=n.tableNodeFill,function(t){var e=t.ctx,i=t.x,n=t.y,o=t.width,r=t.height,a=t.r,s=t.fill,c=t.stroke,l=t.multichamber,h=t.shadow;if(e.save(),e.beginPath(),l)for(var u=0;u++<2;)e.moveTo(i+3*u,n-3*(u-1)),e.arcTo(i+3*u,n-3*u,i+a+3*u,n-3*u,a),e.arcTo(i+o+3*u,n-3*u,i+o+3*u,n+a-3*u,a),e.arcTo(i+o+3*u,n+r-3*u,i+o-a+3*u,n+r-3*u,a),!a&&e.lineTo(i+o-a+3*(u-1),n+r-3*u);e.moveTo(i+a,n),e.arcTo(i+o,n,i+o,n+a,a),e.arcTo(i+o,n+r,i+o-a,n+r,a),e.arcTo(i,n+r,i,n+r-a,a),e.arcTo(i,n,i+a,n,a),h&&(e.shadowColor="#B0B0B0",e.shadowBlur=8,e.shadowOffsetX=3,e.shadowOffsetY=3),s&&e.fill(),c&&e.stroke(),e.restore()}({ctx:t,x:r+.5,y:a+.5,width:i,height:n.tableHandle===N.COLLAPSE&&e.table.collapse?e.table.titleRect.h:o,r:0,fill:!0,stroke:!0,multichamber:!1,shadow:!0}),function(t,e,i,o,r){t&&e.padding&&e.fontSize&&(t.save(),t.fillStyle=e.table.isGroup?n.tableGroupTitleFill:n.tableTitleFill,t.fillRect(e.table.titleRect.x,e.table.titleRect.y,e.table.titleRect.w,e.table.titleRect.h),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(j(t,e.table.name,i-14),o+e.padding,r+e.padding),t.restore())}(t,e,i,r,a),e.table.isGroup&&e.table.collapseRect&&function(t,e){t&&e.table.collapseRect&&(t.save(),t.fillStyle=e.table.isGroup?n.tableGroupTitleFill:n.tableTitleFill,t.fillRect(e.table.collapseRect.x,e.table.collapseRect.y,e.table.collapseRect.w,e.table.collapseRect.h),t.restore())}(t,e),n.tableHandle===N.COLLAPSE?!e.table.fields||e.table.collapse||e.table.isGroup||z(t,e,i,r,a):n.tableHandle===N.SWITCH&&e.table.fields&&e.table.isGroup===e.table.collapse&&z(t,e,i,r,a),e.active&&function(t,e){if(e.table.hidden)return;for(var i=e.calcResizer(),o=0;o<i.length;++o)t.save(),t.strokeStyle=n.resizerStroke,t.fillStyle=n.resizerFill,t.beginPath(),t.fillRect(i[o].x-n.resizerWidth/2,i[o].y-n.resizerWidth/2,n.resizerWidth,n.resizerWidth),t.strokeRect(i[o].x-n.resizerWidth/2,i[o].y-n.resizerWidth/2,n.resizerWidth,n.resizerWidth),t.fill(),t.stroke(),t.restore()}(t,e),t.restore()}}(t,new M(e))}))}function z(t,e,i,o,r){var a=n.tablePadding,s=n.fontSize*n.lineHeight;t&&(t.save(),e.table.fields&&e.table.fields.forEach((function(c,l){r+(l+2)*s+a<=e.rect.y+e.rect.h&&(c.primaryKey&&(t.fillStyle=n.tablePrimarykeyFill,t.fillRect(o+1,r+(l+1)*s+a+.5,i-1,s)),t.beginPath(),t.strokeStyle=n.tableNodeStroke,t.moveTo(o+.5,r+(l+1)*s+a+.5),t.lineTo(o+i+.5,r+(l+1)*s+a+.5),t.stroke(),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(j(t,c.name,i-2*a),a+o,r+n.fontSize+2*a+l*s))})),t.restore())}var B,F=function(){function t(){}return t.prototype.excute=function(t){t.activeNode&&(t.updateNodeActive(t.activeNode),t.updateCanvasWH(),t.render())},t}(),K=function(){function t(){}return t.prototype.excute=function(t){t.updateNodeActive(),t.updateLineActive(),t.render()},t}(),W=function(){function t(){}return t.prototype.excute=function(t){t.updateNodeActive(),t.updateLineActive(),t.render()},t}(),U=function(){function t(){}return t.prototype.excute=function(t){t.updateLineActive(t.activeLine),t.render()},t}(),G=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e);if(t.activeHoverNode){if(n.lineMode===R.ANCHOR){var o=t.getHitAnchor(t.activeHoverNode,i);o?t.addLine({id:t.newLineID,from:t.activeAnchor,to:o,text:"inner"}):t.removeInvalidLine()}else if(n.lineMode===R.HANDLER){var r=t.lines.find((function(e){return e.id===t.newLineID})),a=null==r?void 0:r.getLineToDirection(i);void 0!==a&&a>=0&&t.addLine({id:t.newLineID,from:t.activeAnchor,to:t.activeHoverNode.anchors[a],text:"inner"})}}else t.removeInvalidLine()},t}(),J=function(){function t(t){var e;this.context=t,this.eventStates=((e={})[A.NONE]=new K,e[A.NODECLICK]=new F,e[A.CANVASCLICK]=new W,e[A.LINECLICK]=new U,e[A.ANCHORMATCH]=new G,e)}return t.prototype.setState=function(t){return this.excuter=this.eventStates[t],this},t.prototype.excute=function(t){return this.excuter&&this.excuter.excute(this.context,t),this},t.prototype.reset=function(){this.context.eventType=A.NONE},t}(),V=(B=function(t,e){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}B(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),q=function(){function t(){}return t.prototype.excute=function(t,e){if(t.activeNode){var i=t._calcMousePos(e),o=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,!t.activeNode.outBounds(t.nodes,o)){var r;if(n.lineMode===R.HANDLER)t.activeNode.translate(o,t.lines),(r=t.activeNode.getGenerations(t.nodes))&&r.forEach((function(e){e.translate(o,t.lines)}));else t.activeNode.translate(o),(r=t.activeNode.getGenerations(t.nodes))&&r.forEach((function(t){t.translate(o)}));t.render()}}},t}(),Y=function(){function t(){}return t.prototype.excute=function(t,e){var i,o,r=t._calcMousePos(e);if(t.inLineText(t.lines,r))t.canvas.style.cursor="pointer";else if(n.lineMode===R.HANDLER&&t.getActiveLine(r)&&t.eventType!==A.ANCHORMATCH)t.canvas.style.cursor="move";else if(t.activeHoverNode=t.getActiveHoverNode(r,t.activeHoverNode),t.activeHoverNode?(t.getHitAnchor(t.activeHoverNode,r)?t.canvas.style.cursor="crosshair":(null===(o=null===(i=t.activeHoverNode.table)||void 0===i?void 0:i.collapseRect)||void 0===o?void 0:o.hit(r))?t.canvas.style.cursor="pointer":t.canvas.style.cursor="move",t.render(),t.ctx&&function(t,e,i,o,r){if(!e.table.hidden){e.calcAnchors();for(var a=0;a<e.anchors.length;++a)e.anchors[a].hidden||(t.save(),t.strokeStyle=n.anchorStroke,t.fillStyle=n.anchorFill,t.beginPath(),t.arc(e.anchors[a].x*i-o,e.anchors[a].y*i-r,n.anchorRadius,0,2*Math.PI),t.fill(),t.stroke(),t.restore())}}(t.ctx,t.activeHoverNode,t.scaleRatio,t.scrollLeft,t.scrollTop)):(t.canvas.style.cursor="default",t.render()),t.activeNode){var a=t.activeNode.hitResizer(r);void 0!==a&&a>=0&&(t.canvas.style.cursor=n.resizerCursors[a])}t.activeLine&&(t.getLineControl(t.activeLine,r)&&(t.canvas.style.cursor="pointer"))},t}(),Z=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);t.mousedownPos=i,t.calcScrollDistance(n),t.render()},t}(),X=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,t.activeLine){var o=t.activeLine.from.getLinkNode(t.nodes),r=t.activeLine.to.getLinkNode(t.nodes);o&&r&&n&&t.activeLine.lineMove(o,r,n),t.render()}},t}(),$=function(){function t(){}return t.prototype.excute=function(t,e){if(t.activeNode){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);t.mousedownPos=i,t.activeNode.resize(t.activeResizer,n,t.lines),t.render()}},t}(),Q=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,t.activeLineControl&&t.activeLine){var o=t.activeLineControl.getLinkNode(t.nodes);o&&(t.activeLine.lineEndMove(t.activeLineControl,o,n),t.render())}},t}(),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return V(e,t),e.prototype.excute=function(e,i){e.addLine({id:e.newLineID,from:e.activeAnchor,to:e._calcMousePos(i)}),t.prototype.excute.call(this,e,i)},e}(Y),et=function(){function t(t){var e;this.context=t,this.eventStates=((e={})[A.NONE]=new Y,e[A.NODECLICK]=new q,e[A.CANVASCLICK]=new Z,e[A.LINECLICK]=new X,e[A.ANCHORMATCH]=new tt,e[A.NODERESIZE]=new $,e[A.LINECONTROLCLICK]=new Q,e)}return t.prototype.setState=function(t){return this.excuter=this.eventStates[t],this},t.prototype.excute=function(t){this.excuter&&this.excuter.excute(this.context,t)},t}(),it=function(){function t(){}return t.prototype.excute=function(t,e){var i,r,a=t._calcMousePos(e);t.mousedownPos=a;var s=t.inLineText(t.lines,a),c=t.getActiveLine(a);if(s&&"boolean"!=typeof s)t.activeLineText=s,t.handleTextClick();else if(c&&n.lineMode===R.HANDLER)t.activeLine=c,t.eventType=A.LINECLICK;else{if(t.activeHoverNode){var l=t.getHitAnchor(t.activeHoverNode,a);l?(t.eventType=A.ANCHORMATCH,t.activeAnchor=l,t.newLineID=Object(o.uuid)()):(null===(r=null===(i=t.activeHoverNode.table)||void 0===i?void 0:i.collapseRect)||void 0===r?void 0:r.hit(a))?(t.eventType=A.NODECOLLAPSE,function(t,e){e.table.collapse=!e.table.collapse,e.calcAnchors();var i=e.getGenerations(t);i&&i.forEach((function(e){var i=e.getParentNode(t);i&&(e.table.hidden=i.table.collapse||i.table.hidden)}))}(t.nodes,t.activeHoverNode),t.render()):t.eventType=A.NODECLICK}else t.eventType=A.CANVASCLICK,t.canvas.style.cursor="pointer";if(t.activeNode=t.getActiveNode(a),t.activeNode){var h=t.activeNode.hitResizer(a);void 0!==h&&h>=0&&(t.eventType=A.NODERESIZE,t.activeResizer=h,t.canvas.style.cursor=n.resizerCursors[h])}}if(t.activeLine){var u=t.getLineControl(t.activeLine,a);u&&(t.activeLineControl=u,t.eventType=A.LINECONTROLCLICK)}},t}(),nt=function(){function t(t){this.context=t,this.excuter=new it}return t.prototype.excute=function(t){this.excuter.excute(this.context,t)},t}(),ot=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},rt=function(){function t(t,e){void 0===e&&(e={}),this.parentElem=t,this.options=e,this.canvas=document.createElement("canvas"),this.width=0,this.height=0,this.scaleRatio=1,this.eventType=A.NONE,this.nodes=[],this.lines=[],this.mousedownPos=new P(0,0),this.activeAnchor=new P(0,0),this.newLineID="",this.activeResizer=0,this.scrollTop=0,this.scrollLeft=0,this.padding=10,this.ctx=this.canvas.getContext("2d"),this.load(Object.assign({},H,e))}return t.prototype.load=function(t){var e=t.grid,i=t.data;this.grid=e,this.data=new D(i),this.nodes=this.data.nodes,this.lines=this.data.lines,this.initCanvasWH(),this.parentElem.appendChild(this.canvas),this.registerEventListeners(this.canvas),this.render()},t.prototype.render=function(){var t=this;this.ctx&&(this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.grid&&function(t,e,i){var n=Math.max(e.width,e.height)/(i<1?i:1);if(t){t.save();for(var o=0;10*o<n;)t.strokeStyle=o%4?"#F8F8F8":"#EBEBEB",t.beginPath(),t.moveTo(10*o-.5,-.5),t.lineTo(10*o-.5,n-.5+50),t.stroke(),++o;for(o=0;10*o<n;)t.strokeStyle=o%4?"#F8F8F8":"#EBEBEB",t.beginPath(),t.moveTo(-.5,10*o-.5),t.lineTo(n-.5+50,10*o-.5),t.stroke(),++o;t.restore()}}(this.ctx,this.canvas,this.scaleRatio),this.ctx.translate(-this.scrollLeft,-this.scrollTop),this.ctx.scale(this.scaleRatio,this.scaleRatio),I(this.ctx,this.nodes),this.lines.forEach((function(e){e.hidden(t.nodes)||(n.lineMode===R.ANCHOR&&e.updateEndPoints(t.nodes),t.ctx&&e.draw(t.ctx))})),this.ctx.restore())},t.prototype.registerEventListeners=function(t){var e,i,n=this._registerListener();for(var o in n){var r=Array.isArray(n[o])?n[o]:[n[o]];try{for(var a=(e=void 0,ot(r)),s=a.next();!s.done;s=a.next()){var c=s.value;t.addEventListener(o,c.fn)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}}},t.prototype.removeListener=function(t,e){var i,n;for(var o in console.log(e),t){var r=Array.isArray(t[o])?t[o]:[t[o]];try{for(var a=(i=void 0,ot(r)),s=a.next();!s.done;s=a.next()){var c=s.value;c.el.removeEventListener(o,c.fn)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}}},t.prototype.initCanvasWH=function(){this.width=this.canvas.width=this.parentElem.clientWidth/this.scaleRatio,this.height=this.canvas.height=this.parentElem.clientHeight/this.scaleRatio,this.parentElem.setAttribute("style","width:"+this.width+"px;height:"+this.height+"px")},t.prototype.resize=function(t){this.width=t.width,this.height=t.height,this.parentElem.setAttribute("style","width:"+this.width+"px;height:"+this.height+"px"),this.updateCanvasWH(),this.render()},t.prototype.updateCanvasWH=function(){var t=this.nodes.filter((function(t){return!t.parent})),e=0,i=0;t.forEach((function(t){e=Math.max(e,t.rect.x+t.rect.w),i=Math.max(i,t.rect.y+t.rect.h)})),this.canvas.width=Math.max(this.width,e),this.canvas.height=Math.max(this.height,i)},t.prototype._calcMousePos=function(t){var e=this.canvas.getBoundingClientRect();return new P((t.x-e.x+this.scrollLeft)/this.scaleRatio,(t.y-e.y+this.scrollTop)/this.scaleRatio)},t.prototype.getActiveHoverNode=function(t,e){e&&e.updateNodeAnchorStatus(!0);var i=this.inNode(this.nodes,t);if(i)return e?(i.key===e.key||(e.updateNodeAnchorStatus(!0),i.updateNodeAnchorStatus(!1)),i):(i.updateNodeAnchorStatus(!1),i)},t.prototype.getActiveNode=function(t){var e=this.inNode(this.nodes,t);return e&&this.activeNode?e.key===this.activeNode.key?this.activeNode:e:this.activeNode||e},t.prototype.getLineControl=function(t,e){return t.from.hit(e,n.anchorRadius)?t.from:t.to.hit(e,n.anchorRadius)?t.to:void 0},t.prototype.getHitAnchor=function(t,e){if(t.anchors)return t.anchors.find((function(t){return t.hit(e,n.anchorRadius)}))},t.prototype.inNode=function(t,e){for(var i,n=t.length-1;n>=0;n--)if(!t[n].table.hidden&&a(e,t[n].toPoints())){i=t[n];break}if(i){var o=i.getChildNode(this.nodes);return this.inNode(o,e)||i}return i},t.prototype.inLineText=function(t,e){var i=t.find((function(t){var i=t.toTextPoints();return!!i&&a(e,i)}));return i||!1},t.prototype.addNode=function(t){this.data.locked||(this.nodes.push(new M(t)),this.render())},t.prototype.getActiveLine=function(t){return this.lines.find((function(e){return e.pointIn(t)}))},t.prototype.updateNodeActive=function(t){this.nodes.forEach((function(e){e.active=!!t&&t.key===e.key}))},t.prototype.updateLineActive=function(t){this.lines.forEach((function(e){e.active=!!t&&t.id===e.id}))},t.prototype.addLine=function(t){if(!this.data.locked){var e=this.lines.find((function(e){return e.id===t.id}));e?Object.assign(e,t):this.lines.push(new T(t)),this.render()}},t.prototype.calcScrollDistance=function(t){this.scrollLeft-t.x<=0?this.scrollLeft=0:this.scrollLeft-t.x>=this.canvas.width-this.width?this.scrollLeft=this.canvas.width-this.width:this.scrollLeft-=t.x,this.scrollTop-t.y<=0?this.scrollTop=0:this.scrollTop-t.y>=this.canvas.height-this.height?this.scrollTop=this.canvas.height-this.height:this.scrollTop-=t.y},t.prototype.removeInvalidLine=function(){var t=this;this.lines.splice(this.lines.findIndex((function(e){return e.id===t.newLineID})),1),this.render()},t.prototype.calcDelta=function(t,e){return{x:Number(((t.x-e.x)*this.scaleRatio).toPrecision(1)),y:Number(((t.y-e.y)*this.scaleRatio).toPrecision(1))}},t.prototype.handleDblClick=function(){return this.activeHoverNode},t.prototype.handleTextClick=function(){return this.activeLineText},t.prototype.getParentNode=function(t,e){for(var i,n=t.length-1;n>=0;n--)if(!t[n].table.hidden&&a(e,t[n].toPoints())){i=t[n];break}return i},t.prototype.handleDragover=function(t){var e=new P((t.offsetX+this.scrollLeft)/this.scaleRatio,(t.offsetY+this.scrollTop)/this.scaleRatio),i=this.getParentNode(this.nodes.filter((function(t){return t.table.isGroup})),e);return i?{key:Object(o.uuid)(),parent:i.key,rect:{x:i.rect.x,y:i.rect.y+i.table.titleRect.h,w:n.tableDefaultW,h:n.tableDefaultH}}:{key:Object(o.uuid)(),rect:{x:e.x,y:e.y,w:n.tableDefaultW,h:n.tableDefaultH}}},t.prototype._registerListener=function(){var t,e=this,i=new J(this),n=new et(this),o=new nt(this);return(t={mousedown:{fn:function(t){o.excute(t)}},mousemove:{fn:function(t){n.setState(e.eventType).excute(t)}},mouseup:{fn:function(t){i.setState(e.eventType).excute(t).reset()}},dblclick:{fn:function(t){var i,n,o=e._calcMousePos(t);e.activeHoverNode&&(null===(n=null===(i=e.activeHoverNode.table)||void 0===i?void 0:i.titleRect)||void 0===n?void 0:n.hit(o))&&(e.eventType=A.NODEDBLCLICK,e.handleDblClick()),e.eventType=A.NONE}}})["object"==typeof window.onmousewheel?"mousewheel":"DOMMouseScroll"]={fn:function(t){if(t.deltaY<0)e.scaleRatio=Number((e.scaleRatio+.1).toPrecision(1));else{var i=Number((e.scaleRatio-.1).toPrecision(1));e.scaleRatio=i<.5?.5:i}e.render()}},t},t}(),at=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),st=function(t){function e(e,i,n){void 0===i&&(i={});var o=t.call(this,e,i)||this;return o.fns=n,o}return at(e,t),e.prototype.handleDblClick=function(){var e=t.prototype.handleDblClick.call(this);return this.fns.dblclick(e),e},e.prototype.handleTextClick=function(){var e=t.prototype.handleTextClick.call(this);return this.fns.textclick(e),e},e}(rt)},function(t,e,i){"use strict";var n,o=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},r=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),a=[];function s(t){for(var e=-1,i=0;i<a.length;i++)if(a[i].identifier===t){e=i;break}return e}function c(t,e){for(var i={},n=[],o=0;o<t.length;o++){var r=t[o],c=e.base?r[0]+e.base:r[0],l=i[c]||0,h="".concat(c," ").concat(l);i[c]=l+1;var u=s(h),f={css:r[1],media:r[2],sourceMap:r[3]};-1!==u?(a[u].references++,a[u].updater(f)):a.push({identifier:h,updater:x(f,e),references:1}),n.push(h)}return n}function l(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var o=i.nc;o&&(n.nonce=o)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var a=r(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var h,u=(h=[],function(t,e){return h[t]=e,h.filter(Boolean).join("\n")});function f(t,e,i,n){var o=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=u(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function d(t,e,i){var n=i.css,o=i.media,r=i.sourceMap;if(o?t.setAttribute("media",o):t.removeAttribute("media"),r&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var y=null,p=0;function x(t,e){var i,n,o;if(e.singleton){var r=p++;i=y||(y=l(e)),n=f.bind(null,i,r,!1),o=f.bind(null,i,r,!0)}else i=l(e),n=d.bind(null,i,e),o=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=o());var i=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<i.length;n++){var o=s(i[n]);a[o].references--}for(var r=c(t,e),l=0;l<i.length;l++){var h=s(i[l]);0===a[h].references&&(a[h].updater(),a.splice(h,1))}i=r}}}},function(t,e,i){(e=i(6)(!1)).push([t.i,"#_2YzdkUyx1k0p2m4NxmHgbr{width:1000px;height:500px;display:flex;flex:1;overflow:hidden}#_2YzdkUyx1k0p2m4NxmHgbr #_1kMt4GVfD7TJJVLHbvHh7R{display:flex;flex:1;background:#ffffff;overflow:hidden}#_2YzdkUyx1k0p2m4NxmHgbr #_1kMt4GVfD7TJJVLHbvHh7R #_2VFzkjNexIwn69JXbZAHZX{width:100%;height:100%;margin:auto;overflow:hidden}\n",""]),e.locals={diagramPage:"_2YzdkUyx1k0p2m4NxmHgbr",diagramMain:"_1kMt4GVfD7TJJVLHbvHh7R",canvas:"_2VFzkjNexIwn69JXbZAHZX"},t.exports=e},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var o=(a=n,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),r=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[i].concat(r).concat([o]).join("\n")}var a,s,c;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,n){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(n)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(o[a]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);n&&o[c[0]]||(i&&(c[2]?c[2]="".concat(i," and ").concat(c[2]):c[2]=i),e.push(c))}},e}},function(t,e,i){"use strict";i.r(e);var n=i(1),o=i.n(n);
/**
  * vue-class-component v7.2.5
  * (c) 2015-present Evan You
  * @license MIT
  */
function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(){return"undefined"!=typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function l(t,e){h(t,e),Object.getOwnPropertyNames(e.prototype).forEach((function(i){h(t.prototype,e.prototype,i)})),Object.getOwnPropertyNames(e).forEach((function(i){h(t,e,i)}))}function h(t,e,i){(i?Reflect.getOwnMetadataKeys(e,i):Reflect.getOwnMetadataKeys(e)).forEach((function(n){var o=i?Reflect.getOwnMetadata(n,e,i):Reflect.getOwnMetadata(n,e);i?Reflect.defineMetadata(n,o,t,i):Reflect.defineMetadata(n,o,t)}))}var u={__proto__:[]}instanceof Array;function f(t,e){var i=e.prototype._init;e.prototype._init=function(){var e=this,i=Object.getOwnPropertyNames(t);if(t.$options.props)for(var n in t.$options.props)t.hasOwnProperty(n)||i.push(n);i.forEach((function(i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){t[i]=e},configurable:!0})}))};var n=new e;e.prototype._init=i;var o={};return Object.keys(n).forEach((function(t){void 0!==n[t]&&(o[t]=n[t])})),o}var d=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.name=e.name||t._componentTag||t.name;var i=t.prototype;Object.getOwnPropertyNames(i).forEach((function(t){if("constructor"!==t)if(d.indexOf(t)>-1)e[t]=i[t];else{var n=Object.getOwnPropertyDescriptor(i,t);void 0!==n.value?"function"==typeof n.value?(e.methods||(e.methods={}))[t]=n.value:(e.mixins||(e.mixins=[])).push({data:function(){return a({},t,n.value)}}):(n.get||n.set)&&((e.computed||(e.computed={}))[t]={get:n.get,set:n.set})}})),(e.mixins||(e.mixins=[])).push({data:function(){return f(this,t)}});var n=t.__decorators__;n&&(n.forEach((function(t){return t(e)})),delete t.__decorators__);var r=Object.getPrototypeOf(t.prototype),s=r instanceof o.a?r.constructor:o.a,h=s.extend(e);return x(h,t,s),c()&&l(h,t),h}var p={prototype:!0,arguments:!0,callee:!0,caller:!0};function x(t,e,i){Object.getOwnPropertyNames(e).forEach((function(n){if(!p[n]){var o=Object.getOwnPropertyDescriptor(t,n);if(!o||o.configurable){var a,s,c=Object.getOwnPropertyDescriptor(e,n);if(!u){if("cid"===n)return;var l=Object.getOwnPropertyDescriptor(i,n);if(a=c.value,s=r(a),null!=a&&("object"===s||"function"===s)&&l&&l.value===c.value)return}0,Object.defineProperty(t,n,c)}}}))}function v(t){return"function"==typeof t?y(t):function(e){return y(e,t)}}v.registerHooks=function(t){d.push.apply(d,s(t))};var m=v;"undefined"!=typeof Reflect&&Reflect.getMetadata;var w,b=i(2),g=i.n(b),L=i(3),R=(w=function(t,e){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),N=function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ergRenderer=null,e.ergData={nodes:[{key:"9999",rect:{x:10,y:320,w:200,h:200},table:{}},{key:"0",rect:{x:10,y:10,w:150,h:150},table:{isGroup:!1,name:"dq_A_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}},{key:1,rect:{x:400,y:10,w:400,h:200},table:{isGroup:!0,name:"dq_B_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}},{key:2,parent:1,rect:{x:420,y:100,w:100,h:100},table:{isGroup:!1,name:"dq_C_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}},{key:3,parent:1,rect:{x:550,y:50,w:150,h:150},table:{isGroup:!0,name:"dq_D_table"}},{key:4,parent:3,rect:{x:560,y:90,w:100,h:100},table:{isGroup:!1,name:"dq_E_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}}],lines:[{from:{id:"0",anchorIndex:2},to:{id:"9999",anchorIndex:0},text:"inner"}]},e}return R(e,t),e.prototype.dblclick=function(t){alert(JSON.stringify(t))},e.prototype.textclick=function(t){alert(JSON.stringify(t))},e.prototype.mounted=function(){var t=document.getElementById(g.a.canvas);t&&(this.ergRenderer=new L.Diagram(t,{data:this.ergData},{dblclick:this.dblclick,textclick:this.textclick}))},e.prototype.render=function(t){return t("div",{attrs:{id:g.a.diagramPage}},[t("div",{attrs:{id:g.a.diagramMain}},[t("div",{attrs:{id:g.a.canvas},ref:"canvas"})])])},e=N([m({name:"DiagramComponent"})],e)}(o.a);e.default=P}])}));