!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("vue"));else if("function"==typeof define&&define.amd)define(["vue"],e);else{var i="object"==typeof exports?e(require("vue")):e(t.vue);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,(function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(e,i){e.exports=t},function(t,e,i){var n=i(3),r=i(4);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var o={insert:"head",singleton:!1};n(r,o);t.exports=r.locals||{}},function(t,e,i){"use strict";i.r(e),i.d(e,"Diagram",(function(){return lt})),i.d(e,"uuid",(function(){return ut}));var n={fontColor:"#000000",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"left",textBaseline:"top",textRectFill:"#ffffff",textRectStroke:"#000000",textRectActiveStroke:"#E79D32",lineMode:1,lineJoin:"miter",lineWidth:2,lineStroke:"#000000",lineActiveStroke:"#E79D32",arrowFill:"#000000",arrowStroke:"#000000",arrowActiveFill:"#E79D32",arrowActiveStroke:"#E79D32",defaultLineName:"polyline",defaultFromArrowType:"",defaultToArrowType:"triangleSolid",tableName:"双击",tableDefaultW:100,tableDefaultH:100,tableHandle:1,tableNodeFill:"#ffffff",tableNodeStroke:"#c1c7cd",tableNodeBorderColor:"#0C64EB",tablePadding:10,tableTitleFill:"#e1e7ed",tableGroupTitleFill:"#d0e2ff",tablePrimarykeyFill:"#fffaf1",anchorRadius:5,anchorFill:"#ffffff",anchorStroke:"#ff0000",resizerStroke:"#0C64EB",resizerFill:"#ffffff",resizerWidth:10,resizerCursors:["nw-resize","ne-resize","se-resize","sw-resize"],thumbnail:!1,thumbnailW:240,thumbnailH:140,thumbnailFillBg:"#ffffff",thumbnailFillRect:"rgba(0,0,0,0.2)"},r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function o(t,e){var i,n;if(e.length<3)return!1;var o=!1,a=e[e.length-1];try{for(var s=r(e),c=s.next();!c.done;c=s.next()){var l=c.value;(l.y<t.y&&a.y>=t.y||l.y>=t.y&&a.y<t.y)&&l.x+(t.y-l.y)*(a.x-l.x)/(a.y-l.y)>t.x&&(o=!o),a=l}}catch(t){i={error:t}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function a(t,e,i){return o(t,[new S(e.x-8,e.y-8),new S(i.x-8,i.y-8),new S(i.x+8,i.y+8),new S(e.x+8,e.y+8)])}function s(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function c(){return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s()}var l=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function h(t,e){var i,r;t.strokeStyle=e.active?n.lineActiveStroke:n.lineStroke,t.beginPath(),t.moveTo(e.from.x,e.from.y);try{for(var o=l(e.controlPoints),a=o.next();!a.done;a=o.next()){var s=a.value;t.lineTo(s.x,s.y)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}t.lineTo(e.to.x,e.to.y),t.stroke()}function u(t,e){t.save(),t.fillStyle="#fff",t.strokeStyle=e.active?n.lineActiveStroke:n.lineStroke,t.lineWidth=2,f(t,e.from),f(t,e.to),t.restore()}function f(t,e){t.beginPath(),t.arc(e.x,e.y,n.anchorRadius,0,2*Math.PI),t.stroke(),t.fill()}function y(t){t.controlPoints=[];var e=p(t.from,t.to);void 0!==t.from.direction&&t.controlPoints.push(e);var i=p(t.to,t.from),n=[];switch(e.direction){case L.Up:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y>e.y)return e.direction===L.Up&&t.y-e.y>150?t.x<e.x?e.x-t.x<50?[new S(t.x-100,t.y),new S(t.x-100,e.y)]:[new S(t.x,e.y)]:t.x-e.x<50?[new S(t.x+100,t.y),new S(t.x+100,e.y)]:[new S(t.x,e.y)]:e.direction===L.Left&&t.x>e.x||e.direction===L.Right&&t.x<e.x?[new S(e.x,t.y)]:[new S(t.x,e.y)];if(e.direction===L.Bottom){if(t.x<e.x)return x(t,e);var i=x(e,t);return[i[1],i[0]]}return[new S(e.x,t.y)]}(e,i);break;case L.Right:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x<e.x)return e.direction===L.Right&&e.x-t.x>150?t.y<e.y?e.y-t.y<50?[new S(t.x,t.y-100),new S(e.x,t.y-100)]:[new S(e.x,t.y)]:t.y-e.y<50?[new S(t.x,t.y+100),new S(e.x,t.y+100)]:[new S(e.x,t.y)]:e.direction===L.Right||e.direction===L.Up&&t.y<e.y||e.direction===L.Bottom&&t.y>e.y?[new S(e.x,t.y)]:[new S(t.x,e.y)];if(e.direction===L.Left){if(t.y<e.y)return v(t,e);var i=v(e,t);return[i[1],i[0]]}return[new S(t.x,e.y)]}(e,i);break;case L.Bottom:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y<e.y)return e.direction===L.Bottom&&e.y-t.y>150?t.x<e.x?e.x-t.x<50?[new S(t.x-100,t.y),new S(t.x-100,e.y)]:[new S(t.x,e.y)]:t.x-e.x<50?[new S(t.x+100,t.y),new S(t.x+100,e.y)]:[new S(t.x,e.y)]:e.direction===L.Left&&t.x>e.x||e.direction===L.Right&&t.x<e.x?[new S(e.x,t.y)]:[new S(t.x,e.y)];if(e.direction===L.Up){if(t.x<e.x)return x(t,e);var i=x(e,t);return[i[1],i[0]]}return[new S(e.x,t.y)]}(e,i);break;case L.Left:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x>e.x)return e.direction===L.Left&&t.x-e.x>150?t.y<e.y?e.y-t.y<50?[new S(t.x,t.y+100),new S(e.x,t.y+100)]:[new S(e.x,t.y)]:t.y-e.y<50?[new S(t.x,t.y-100),new S(e.x,t.y-100)]:[new S(e.x,t.y)]:e.direction===L.Left||e.direction===L.Up&&t.y<e.y||e.direction===L.Bottom&&t.y>e.y?[new S(e.x,t.y)]:[new S(t.x,e.y)];if(e.direction===L.Right){if(t.y<e.y)return v(t,e);var i=v(e,t);return[i[1],i[0]]}return[new S(t.x,e.y)]}(e,i)}t.controlPoints.push.apply(t.controlPoints,n),void 0!==t.to.direction&&t.controlPoints.push(i)}function d(t,e){if(!e.controlPoints||!e.controlPoints.length)return a(t,e.from,e.to);if(a(t,e.from,e.controlPoints[0]))return!0;if(a(t,e.to,e.controlPoints[e.controlPoints.length-1]))return!0;for(var i=0;i<e.controlPoints.length-1;++i)if(a(t,e.controlPoints[i],e.controlPoints[i+1]))return!0;return!1}function p(t,e){var i=t.clone();switch(t.direction){case L.Up:e.y<t.y?i.y-=Math.floor((t.y-e.y)/2):i.y-=50;break;case L.Right:e.x>t.x?i.x+=Math.floor((e.x-t.x)/2):i.x+=50;break;case L.Bottom:e.y>t.y?i.y+=Math.floor((e.y-t.y)/2):i.y+=50;break;case L.Left:e.x<t.x?i.x-=Math.floor((t.x-e.x)/2):i.x-=50}return i}function x(t,e){var i=t.x+(e.x-t.x)/2;return[new S(i,t.y),new S(i,e.y)]}function v(t,e){var i=t.y+(e.y-t.y)/2;return[new S(t.x,i),new S(e.x,i)]}function m(t,e,i,n,r){n+=3*t.lineWidth;var o=t.lineWidth/10;t.lineWidth<2&&(t.lineWidth=2,o=0),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x-t.lineWidth+5*o,-i.y),t.moveTo(i.x,i.y+o),t.lineTo(i.x,i.y-o),t.lineTo(i.x-n,i.y-n/3),t.lineTo(i.x-n,i.y+n/3),t.closePath(),t.stroke(),r&&(t.fillStyle=r),t.fill()}function b(t,e,i,n){m(t,e,i,n,"#fff")}var w={},g={};w.polyline={drawFn:h,controlPointsFn:y,drawEndPointsFn:u,pointIn:d},g.triangleSolid=m,g.triangle=b;var L,R,N,P,S=function(){function t(t,e,i,n,r,o){void 0===o&&(o=0),this.x=t,this.y=e,this.direction=i,this.id=n,this.hidden=r,this.anchorIndex=o,this.id=n,this.direction=i,this.anchorIndex=i||0,this.hidden=r||!1}return t.prototype.clone=function(){return new t(this.x,this.y,this.direction)},t.prototype.floor=function(){this.x|=0,this.y|=0},t.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},t.prototype.hit=function(t,e){return void 0===e&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},t.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,n=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=n,this},t.prototype.getLinkNode=function(t){var e=this;return t.find((function(t){return t.key===e.id}))},t.prototype.updateDirection=function(t){this.direction=t,this.anchorIndex=t},t}(),C=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(){function t(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n,this.center=new S(0,0),i<0&&(i=0),n<0&&(n=0),this.init()}return t.prototype.init=function(){this.ex=this.x+this.w,this.ey=this.y+this.h,this.calcCenter()},t.prototype.floor=function(){this.x|=0,this.y|=0,this.w|=0,this.h|=0,this.init()},t.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y),this.w=Math.round(this.w),this.h=Math.round(this.h),this.init()},t.prototype.clone=function(){return new t(this.x,this.y,this.w,this.h)},t.prototype.hit=function(t,e){return void 0===e&&(e=0),t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},t.prototype.hitByRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},t.prototype.hitRotate=function(t,e,i){var n,r,a=this.toPoints();try{for(var s=C(a),c=s.next();!c.done;c=s.next()){c.value.rotate(e,i)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o(t,a)},t.prototype.calcCenter=function(){this.center.x=this.x+this.w/2,this.center.y=this.y+this.h/2},t.prototype.toPoints=function(){return[new S(this.x,this.y),new S(this.ex,this.y),new S(this.ex,this.ey),new S(this.x,this.ey)]},t.prototype.translate=function(t,e){this.x+=t,this.y+=e,this.ex+=t,this.ey+=e,this.calcCenter()},t.prototype.scale=function(t,e,i){e||(e=this.center),void 0===i&&(i=t),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*i,this.w*=t,this.h*=i,this.init()},t}();!function(t){t[t.Up=0]="Up",t[t.Right=1]="Right",t[t.Bottom=2]="Bottom",t[t.Left=3]="Left"}(L||(L={})),function(t){t[t.LeftTop=0]="LeftTop",t[t.RightTop=1]="RightTop",t[t.RightBottom=2]="RightBottom",t[t.LeftBottom=3]="LeftBottom"}(R||(R={})),function(t){t[t.ANCHOR=0]="ANCHOR",t[t.HANDLER=1]="HANDLER"}(N||(N={})),function(t){t[t.COLLAPSE=0]="COLLAPSE",t[t.SWITCH=1]="SWITCH"}(P||(P={}));var k,T=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},E=function(){function t(t){var e,i;if(this.controlPoints=[],this.fromArrowSize=5,this.toArrowSize=5,this.active=!1,this.animatePos=0,this.isAnimate=!1,this.animateFromSize=0,this.animateToSize=0,t){if(t.from&&(this.from=t.from),t.to&&(this.to=t.to),this.id=t.id||c(),this.name=t.name||n.defaultLineName,this.fromArrow=t.fromArrow||n.defaultFromArrowType,this.toArrow=t.toArrow||n.defaultToArrowType,this.calcControlPoints(),t.controlPoints)try{for(var r=T(t.controlPoints),o=r.next();!o.done;o=r.next()){var a=o.value;this.controlPoints.push(new S(a.x,a.y,a.direction))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}this.animateColor=t.animateColor||"",this.animateSpan=t.animateSpan||1,this.text=t.text}else this.name=n.defaultLineName,this.fromArrow=n.defaultToArrowType}return t.prototype.calcTextRect=function(){var t=this.getCenter(),e=n.lineHeight*n.fontSize;this.textRect=new A(t.x-25,t.y-e/2,50,e)},t.prototype.getTextRect=function(){return this.textRect||this.calcTextRect(),this.textRect},t.prototype.pointIn=function(t){return w[this.name].pointIn(t,this)},t.prototype.toTextPoints=function(){return!!this.textRect&&[new S(this.textRect.x,this.textRect.y),new S(this.textRect.x+this.textRect.w,this.textRect.y),new S(this.textRect.x+this.textRect.w,this.textRect.y+this.textRect.h),new S(this.textRect.x,this.textRect.y+this.textRect.h)]},t.prototype.getCenter=function(){var t=new S(this.from.x,this.from.y),e=Math.floor(this.controlPoints.length/2);switch(this.name){case"polyline":t=this.getLineCenter(this.controlPoints[e-1],this.controlPoints[e])}return t},t.prototype.getLineCenter=function(t,e){return new S((t.x+e.x)/2,(t.y+e.y)/2)},t.prototype._drawText=function(t){this.getTextRect(),t&&this.text&&this.textRect&&(t.save(),t.fillStyle=n.textRectFill,t.strokeStyle=this.active?n.textRectActiveStroke:n.textRectStroke,t.fillRect(this.textRect.x,this.textRect.y,this.textRect.w,this.textRect.h),t.strokeRect(this.textRect.x,this.textRect.y,this.textRect.w,this.textRect.h),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(this.text,this.textRect.x+(this.textRect.w-t.measureText(this.text).width)/2,this.textRect.y+(this.textRect.h-n.fontSize)/2),t.restore())},t.prototype.calcControlPoints=function(){this.from&&this.to&&w[this.name]&&w[this.name].controlPointsFn(this)},t.prototype.draw=function(t){n.lineMode===N.HANDLER&&this.calcControlPoints(),this.isAnimate||(t.save(),t.lineJoin=n.lineJoin,t.lineWidth=n.lineWidth,w[this.name]&&w[this.name].drawFn(t,this),t.restore());if(this.fromArrow&&g[this.fromArrow]){t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.active?n.arrowActiveFill:n.arrowFill,t.strokeStyle=this.active?n.arrowActiveStroke:n.arrowStroke;var e=this.to;e=this.controlPoints[0],g[this.fromArrow](t,e,this.from,1*this.fromArrowSize),t.restore()}if(this.toArrow&&g[this.toArrow]){t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.active?n.arrowActiveFill:n.arrowFill,t.strokeStyle=this.active?n.arrowActiveStroke:n.arrowStroke;e=this.from;e=this.controlPoints[this.controlPoints.length-1],g[this.toArrow](t,e,this.to,1*this.toArrowSize),t.restore()}n.lineMode===N.HANDLER&&this.active&&w[this.name].drawEndPointsFn(t,this),this.text&&!this.isAnimate&&(this.calcTextRect(),this._drawText(t))},t.prototype.getLineToDirection=function(t){var e=this.controlPoints[this.controlPoints.length-1];return t.y>e.y?L.Up:t.y<e.y?L.Bottom:t.x>e.x?L.Left:t.x<e.x?L.Right:void 0},t.prototype.hidden=function(t){var e=this,i=t.find((function(t){return t.key===e.from.id})),n=t.find((function(t){return t.key===e.to.id}));return!(!(null==i?void 0:i.table.hidden)&&!(null==n?void 0:n.table.hidden))},t.prototype.getPointByPos=function(t){var e,i;if(t<=0)return this.from;switch(this.name){case"polyline":if(this.controlPoints&&this.controlPoints.length){var n=this.controlPoints.concat(this.to),r=this.from;try{for(var o=T(n),a=o.next();!a.done;a=o.next()){var s=a.value,c=this.lineLen(r,s);if(!(t>c))return this.getLinePtByPos(r,s,t);t-=c,r=s}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}return this.to}return this.getLinePtByPos(this.from,this.to,t)}return null},t.prototype.getLinePtByPos=function(t,e,i){var n=this.lineLen(t,e);if(i<=0)return t;if(i>=n)return e;var r=t.x+(e.x-t.x)*(i/n),o=t.y+(e.y-t.y)*(i/n);return new S(r,o)},t.prototype.round=function(){this.from.round(),this.to.round()},t.prototype.lineLen=function(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},t.prototype.translate=function(t,e){var i,n;this.from.x+=t,this.from.y+=e,this.to.x+=t,this.to.y+=e;try{for(var r=T(this.controlPoints),o=r.next();!o.done;o=r.next()){var a=o.value;a.x+=t,a.y+=e}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}},t.prototype.updateEndPoints=function(t){this.from=this.updateEndPoint(t,this.from),this.to=this.updateEndPoint(t,this.to),this.calcControlPoints()},t.prototype.updateEndPoint=function(t,e){var i=t.find((function(t){return t.key===e.id}));return i?i.anchors[e.anchorIndex]:e},t.prototype._calcPosition=function(t,e,i){var n=e.toRect();t.direction===L.Bottom||t.direction===L.Up?(t.x+=i.x,t.x>n.ex&&(t.x=n.ex,t.y=n.y+n.h/2,t.updateDirection(L.Right)),t.x<n.x&&(t.x=n.x,t.y=n.y+n.h/2,t.updateDirection(L.Left))):(t.y+=i.y,t.y>n.ey&&(t.y=n.ey,t.x=n.x+n.w/2,t.updateDirection(L.Bottom)),t.y<n.y&&(t.y=n.y,t.x=n.x+n.w/2,t.updateDirection(L.Up)))},t.prototype.lineMove=function(t,e,i){this._calcPosition(this.from,t,i),this._calcPosition(this.to,e,i)},t.prototype.lineEndMove=function(t,e,i){var n=e.toRect();t.direction===L.Bottom||t.direction===L.Up?(t.x+=i.x,t.x>n.ex&&(t.x=n.ex,t.updateDirection(L.Right)),t.x<n.x&&(t.x=n.x,t.updateDirection(L.Left))):(t.y+=i.y,t.y>n.ey&&(t.y=n.ey,t.updateDirection(L.Bottom)),t.y<n.y&&(t.y=n.y,t.updateDirection(L.Up)))},t}(),O=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a},H=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(O(arguments[e]));return t},M=function(){function t(t){this.key=t.key,this.parent=t.parent,this.rect=t.rect,this.padding=t.padding||n.tablePadding,this.fontSize=t.fontSize||n.fontSize,this.table=t.table,this.table.collapse=t.table.collapse||!1,this.table.hidden=t.table.hidden||!1,this.table.name=t.table.name||n.tableName,this.table.titleRect=new A(this.rect.x+.5,this.rect.y+.5,this.table.isGroup?this.rect.w-(this.fontSize+2*this.padding):this.rect.w-.5,this.fontSize+2*this.padding),this.table.collapseRect=this.table.isGroup?new A(this.rect.x+this.rect.w-this.fontSize-2*this.padding,this.rect.y+.5,this.fontSize+2*this.padding,this.fontSize+2*this.padding):null,this.alias=t.alias||"",this.active=t.active||!1,this.anchors=t.anchors||this.calcAnchors()}return t.prototype.toPoints=function(){return[new S(this.rect.x,this.rect.y),new S(this.rect.x+this.rect.w,this.rect.y),new S(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h)),new S(this.rect.x,this.rect.y+(n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h))]},t.prototype.toRect=function(){return new A(this.rect.x,this.rect.y,this.rect.w,n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h)},t.prototype.translate=function(t,e){var i=this;this.rect.x+=t.x,this.rect.y+=t.y,this.calcAnchors(),n.lineMode===N.HANDLER&&e&&e.forEach((function(e){e.from.id===i.key&&(e.from.x+=t.x,e.from.y+=t.y),e.to.id===i.key&&(e.to.x+=t.x,e.to.y+=t.y)}))},t.prototype.calcResizer=function(){var t=[];return t.push(new S(this.rect.x,this.rect.y,R.LeftTop,this.key)),t.push(new S(this.rect.x+this.rect.w,this.rect.y,R.RightTop,this.key)),t.push(new S(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),R.RightBottom,this.key)),t.push(new S(this.rect.x,this.rect.y+(n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),R.LeftBottom,this.key)),t},t.prototype.hitResizer=function(t){if(this.active)return this.calcResizer().findIndex((function(e){return e.hit(t,n.resizerWidth/2)}))},t.prototype.resize=function(t,e,i,r){var o=this;if(!(0===n.tableHandle&&this.table.collapse||this.rect.h<=this.table.titleRect.h)){var a=this.getParentNode(t);switch(e){case R.LeftTop:a?(this.resizeFromParent(a,i,L.Left),this.resizeFromParent(a,i,L.Up)):(this.rect.x+=i.x,this.rect.y+=i.y,this.rect.w-=i.x,this.rect.h-=i.y);break;case R.RightTop:a?(this.resizeFromParent(a,i,L.Right),this.resizeFromParent(a,i,L.Up)):(this.rect.y+=i.y,this.rect.w+=i.x,this.rect.h-=i.y);break;case R.RightBottom:a?(this.resizeFromParent(a,i,L.Right),this.resizeFromParent(a,i,L.Bottom)):(this.rect.w+=i.x,this.rect.h+=i.y);break;case R.LeftBottom:a?(this.resizeFromParent(a,i,L.Left),this.resizeFromParent(a,i,L.Bottom)):(this.rect.x+=i.x,this.rect.w-=i.x,this.rect.h+=i.y)}this.calcAnchors(),n.lineMode===N.HANDLER&&r&&r.forEach((function(t){t.from.id===o.key&&o._calcLinePosition(t.from),t.to.id===o.key&&o._calcLinePosition(t.to)}))}},t.prototype.resizeFromParent=function(t,e,i){switch(i){case L.Left:this.rect.x+e.x<=t.rect.x?this.rect.x=t.rect.x:(this.rect.x+=e.x,this.rect.w-=e.x);break;case L.Up:this.rect.y+e.y<=t.rect.y+t.table.titleRect.h?this.rect.y=t.rect.y+t.table.titleRect.h:(this.rect.y+=e.y,this.rect.h-=e.y);break;case L.Right:this.rect.x+this.rect.w+e.x>=t.rect.x+t.rect.w||(this.rect.w+=e.x);break;case L.Bottom:this.rect.y+this.rect.h+e.y>=t.rect.y+t.rect.h||(this.rect.h+=e.y)}},t.prototype._calcLinePosition=function(t){t.direction!==L.Bottom&&t.direction!==L.Up||(t.y=t.direction===L.Bottom?this.rect.y+this.rect.h:this.rect.y,t.x<this.rect.x&&(t.x=this.rect.x),t.x>this.rect.x+this.rect.w&&(t.x=this.rect.x+this.rect.w)),t.direction!==L.Left&&t.direction!==L.Right||(t.x=t.direction===L.Left?this.rect.x:this.rect.x+this.rect.w,t.y<this.rect.y&&(t.y=this.rect.y),t.y>this.rect.y+this.rect.h&&(t.y=this.rect.y+this.rect.h))},t.prototype.calcAnchors=function(){return this.anchors=[],this.anchors.push(new S(this.rect.x+this.rect.w/2,this.rect.y,L.Up,this.key)),this.anchors.push(new S(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h/2:this.rect.h/2),L.Right,this.key)),this.anchors.push(new S(this.rect.x+this.rect.w/2,this.rect.y+(n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),L.Bottom,this.key)),this.anchors.push(new S(this.rect.x,this.rect.y+(n.tableHandle===P.COLLAPSE&&this.table.collapse?this.table.titleRect.h/2:this.rect.h/2),L.Left,this.key)),this.anchors},t.prototype.getChildNode=function(t){var e=this;return t.filter((function(t){return t.parent===e.key}))},t.prototype.getGenerations=function(t){var e=[],i=function(n){var r=n.getChildNode(t);r&&(e.push.apply(e,H(r)),r.forEach((function(t){return i(t)})))};return i(this),e},t.prototype.getParentNode=function(t){var e=this;return t.find((function(t){return t.key===e.parent}))},t.prototype.outBounds=function(t,e){var i=this.table.collapse?this.table.titleRect:this.rect,n=this.getParentNode(t);return!!n&&(i.x+i.w+e.x>=n.rect.x+n.rect.w||i.x+e.x<=n.rect.x||i.y+e.y<=n.rect.y+n.table.titleRect.h||i.y+i.h+e.y>=n.rect.y+n.rect.h)},t.prototype.updateNodeAnchorStatus=function(t){for(var e=0;e<this.anchors.length;++e)this.anchors[e].hidden=t},t}();!function(t){t.NONE="None",t.NODEHOVER="NodeHover",t.NODECLICK="NodeClick",t.NODERESIZE="NodeResize",t.NODEDBLCLICK="NodeDblClick",t.NODECOLLAPSE="NodeCollapse",t.ANCHORMATCH="AnchorMatch",t.LINECLICK="LineClick",t.LINECONTROLCLICK="LineControlClick",t.CANVASCLICK="CanvasClick"}(k||(k={}));var D={grid:!0,font:{color:n.fontColor,fontFamily:n.fontFamily,fontSize:n.fontSize,lineHeight:n.lineHeight,textAlign:n.textAlign,textBaseline:n.textBaseline}},_=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},z=function(){function t(t){var e,i,r,o;if(this.nodes=[],this.lines=[],t){this.nodes=[];try{for(var a=_(t.nodes),s=a.next();!s.done;s=a.next()){var c=s.value;this.nodes.push(new M(c))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}this.lines=[];try{for(var l=_(t.lines),h=l.next();!h.done;h=l.next()){!(c=h.value).from||c.from instanceof S||(c.from=this.translateLineOptionToPoint(this.nodes,c.from)),!c.to||c.to instanceof S||(c.to=this.translateLineOptionToPoint(this.nodes,c.to)),this.lines.push(new E(c))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}this.lineName=t.lineName||n.defaultLineName,this.fromArrowType=t.fromArrowType||n.defaultFromArrowType,this.toArrowType=t.toArrowType||n.defaultToArrowType,this.scale=t.scale||1,this.locked=t.locked||0}}return t.prototype.translateLineOptionToPoint=function(t,e){var i=t.find((function(t){return t.key===e.id}));return i?i.anchors[e.anchorIndex]:e},t}();function I(t,e,i){var n=t.measureText(e).width,r=t.measureText("…").width;if(n<=i||i<=r)return e;for(var o=e.length;n>=i-r&&o-- >0;)e=e.slice(0,o),n=t.measureText(e).width;return e+"…"}function B(t,e){e.forEach((function(e){!e.table.hidden&&function(t,e){if(t){t.save();var i=Number(e.rect.w)||100,r=Number(e.rect.h)||50,o=Number(e.rect.x),a=Number(e.rect.y);t.strokeStyle=e.active?n.resizerStroke:n.tableNodeStroke,t.fillStyle=n.tableNodeFill,function(t){var e=t.ctx,i=t.x,n=t.y,r=t.width,o=t.height,a=t.r,s=t.fill,c=t.stroke,l=t.multichamber,h=t.shadow;if(e.save(),e.beginPath(),l)for(var u=0;u++<2;)e.moveTo(i+3*u,n-3*(u-1)),e.arcTo(i+3*u,n-3*u,i+a+3*u,n-3*u,a),e.arcTo(i+r+3*u,n-3*u,i+r+3*u,n+a-3*u,a),e.arcTo(i+r+3*u,n+o-3*u,i+r-a+3*u,n+o-3*u,a),!a&&e.lineTo(i+r-a+3*(u-1),n+o-3*u);e.moveTo(i+a,n),e.arcTo(i+r,n,i+r,n+a,a),e.arcTo(i+r,n+o,i+r-a,n+o,a),e.arcTo(i,n+o,i,n+o-a,a),e.arcTo(i,n,i+a,n,a),h&&(e.shadowColor="#B0B0B0",e.shadowBlur=8,e.shadowOffsetX=3,e.shadowOffsetY=3),s&&e.fill(),c&&e.stroke(),e.restore()}({ctx:t,x:o+.5,y:a+.5,width:i,height:n.tableHandle===P.COLLAPSE&&e.table.collapse?e.table.titleRect.h:r,r:0,fill:!0,stroke:!0,multichamber:!1,shadow:!0}),function(t,e,i,r,o){t&&e.padding&&e.fontSize&&(t.save(),t.fillStyle=e.table.isGroup?n.tableGroupTitleFill:n.tableTitleFill,t.fillRect(e.table.titleRect.x,e.table.titleRect.y,e.table.titleRect.w,e.table.titleRect.h),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(I(t,e.table.name,i-14),r+e.padding,o+e.padding),t.restore())}(t,e,i,o,a),e.table.isGroup&&e.table.collapseRect&&function(t,e){t&&e.table.collapseRect&&(t.save(),t.fillStyle=e.table.isGroup?n.tableGroupTitleFill:n.tableTitleFill,t.fillRect(e.table.collapseRect.x,e.table.collapseRect.y,e.table.collapseRect.w,e.table.collapseRect.h),t.restore())}(t,e),n.tableHandle===P.COLLAPSE?!e.table.fields||e.table.collapse||e.table.isGroup||F(t,e,i,o,a):n.tableHandle===P.SWITCH&&e.table.fields&&e.table.isGroup===e.table.collapse&&F(t,e,i,o,a),e.active&&function(t,e){if(e.table.hidden)return;for(var i=e.calcResizer(),r=0;r<i.length;++r)t.save(),t.strokeStyle=n.resizerStroke,t.fillStyle=n.resizerFill,t.beginPath(),t.fillRect(i[r].x-n.resizerWidth/2,i[r].y-n.resizerWidth/2,n.resizerWidth,n.resizerWidth),t.strokeRect(i[r].x-n.resizerWidth/2,i[r].y-n.resizerWidth/2,n.resizerWidth,n.resizerWidth),t.fill(),t.stroke(),t.restore()}(t,e),t.restore()}}(t,new M(e))}))}function F(t,e,i,r,o){var a=n.tablePadding,s=n.fontSize*n.lineHeight;t&&(t.save(),e.table.fields&&e.table.fields.forEach((function(c,l){o+(l+2)*s+a<=e.rect.y+e.rect.h&&(c.primaryKey&&(t.fillStyle=n.tablePrimarykeyFill,t.fillRect(r+1,o+(l+1)*s+a+.5,i-1,s)),t.beginPath(),t.strokeStyle=n.tableNodeStroke,t.moveTo(r+.5,o+(l+1)*s+a+.5),t.lineTo(r+i+.5,o+(l+1)*s+a+.5),t.stroke(),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(I(t,c.name,i-2*a),a+r,o+n.fontSize+2*a+l*s))})),t.restore())}var j,K=function(){function t(){}return t.prototype.excute=function(t){t.activeNode&&(t.updateNodeActive(t.activeNode),t.updateCanvasWH(),t.render())},t}(),W=function(){function t(){}return t.prototype.excute=function(t){t.updateNodeActive(),t.updateLineActive(),t.render()},t}(),U=function(){function t(){}return t.prototype.excute=function(t){t.updateNodeActive(),t.updateLineActive(),t.render()},t}(),G=function(){function t(){}return t.prototype.excute=function(t){t.updateLineActive(t.activeLine),t.render()},t}(),J=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e);if(t.activeHoverNode){if(n.lineMode===N.ANCHOR){var r=t.getHitAnchor(t.activeHoverNode,i);r?t.addLine({id:t.newLineID,from:t.activeAnchor,to:r,text:"inner"}):t.removeInvalidLine()}else if(n.lineMode===N.HANDLER){var o=t.lines.find((function(e){return e.id===t.newLineID})),a=null==o?void 0:o.getLineToDirection(i);void 0!==a&&a>=0&&t.addLine({id:t.newLineID,from:t.activeAnchor,to:t.activeHoverNode.anchors[a],text:"inner"})}}else t.removeInvalidLine()},t}(),V=function(){function t(){}return t.prototype.excute=function(t){t.activeHoverNode&&(!function(t,e){e.table.collapse=!e.table.collapse,e.calcAnchors();var i=e.getGenerations(t);i&&i.forEach((function(e){var i=e.getParentNode(t);i&&(e.table.hidden=i.table.collapse||i.table.hidden)}))}(t.nodes,t.activeHoverNode),t.render())},t}(),Y=function(){function t(t){var e;this.context=t,this.eventStates=((e={})[k.NONE]=new W,e[k.NODECLICK]=new K,e[k.CANVASCLICK]=new U,e[k.LINECLICK]=new G,e[k.ANCHORMATCH]=new J,e[k.NODECOLLAPSE]=new V,e)}return t.prototype.setState=function(t){return this.excuter=this.eventStates[t],this},t.prototype.excute=function(t){return this.excuter&&this.excuter.excute(this.context,t),this},t.prototype.reset=function(){this.context.eventType=k.NONE},t}(),Z=(j=function(t,e){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),X=function(){function t(){}return t.prototype.excute=function(t,e){if(t.activeNode){var i=t._calcMousePos(e),r=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,!t.activeNode.outBounds(t.nodes,r)){var o;if(n.lineMode===N.HANDLER)t.activeNode.translate(r,t.lines),(o=t.activeNode.getGenerations(t.nodes))&&o.forEach((function(e){e.translate(r,t.lines)}));else t.activeNode.translate(r),(o=t.activeNode.getGenerations(t.nodes))&&o.forEach((function(t){t.translate(r)}));t.render()}}},t}(),q=function(){function t(){}return t.prototype.excute=function(t,e){var i,r,o=t._calcMousePos(e);if(t.inLineText(t.lines,o))t.canvas.style.cursor="pointer";else if(n.lineMode===N.HANDLER&&t.getActiveLine(o)&&t.eventType!==k.ANCHORMATCH)t.canvas.style.cursor="move";else if(t.activeHoverNode=t.getActiveHoverNode(o,t.activeHoverNode),t.activeHoverNode?(t.getHitAnchor(t.activeHoverNode,o)?t.canvas.style.cursor="crosshair":(null===(r=null===(i=t.activeHoverNode.table)||void 0===i?void 0:i.collapseRect)||void 0===r?void 0:r.hit(o))?t.canvas.style.cursor="pointer":t.canvas.style.cursor="move",t.render(),t.ctx&&function(t,e,i,r,o){if(!e.table.hidden){e.calcAnchors();for(var a=0;a<e.anchors.length;++a)e.anchors[a].hidden||(t.save(),t.strokeStyle=n.anchorStroke,t.fillStyle=n.anchorFill,t.beginPath(),t.arc(e.anchors[a].x*i-r,e.anchors[a].y*i-o,n.anchorRadius,0,2*Math.PI),t.fill(),t.stroke(),t.restore())}}(t.ctx,t.activeHoverNode,t.scaleRatio,t.scrollLeft,t.scrollTop)):(t.canvas.style.cursor="default",t.render()),t.activeNode){var a=t.activeNode.hitResizer(o);void 0!==a&&a>=0&&(t.canvas.style.cursor=n.resizerCursors[a])}t.activeLine&&(t.getLineControl(t.activeLine,o)&&(t.canvas.style.cursor="pointer"))},t}(),$=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);t.mousedownPos=i,t.calcScrollDistance(n),t.render()},t}(),Q=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,t.activeLine){var r=t.activeLine.from.getLinkNode(t.nodes),o=t.activeLine.to.getLinkNode(t.nodes);r&&o&&n&&t.activeLine.lineMove(r,o,n),t.render()}},t}(),tt=function(){function t(){}return t.prototype.excute=function(t,e){if(t.activeNode){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);t.mousedownPos=i,t.activeNode.resize(t.nodes,t.activeResizer,n,t.lines),t.render()}},t}(),et=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,t.activeLineControl&&t.activeLine){var r=t.activeLineControl.getLinkNode(t.nodes);r&&(t.activeLine.lineEndMove(t.activeLineControl,r,n),t.render())}},t}(),it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Z(e,t),e.prototype.excute=function(e,i){e.addLine({id:e.newLineID,from:e.activeAnchor,to:e._calcMousePos(i)}),t.prototype.excute.call(this,e,i)},e}(q),nt=function(){function t(t){var e;this.context=t,this.eventStates=((e={})[k.NONE]=new q,e[k.NODECLICK]=new X,e[k.CANVASCLICK]=new $,e[k.LINECLICK]=new Q,e[k.ANCHORMATCH]=new it,e[k.NODERESIZE]=new tt,e[k.LINECONTROLCLICK]=new et,e)}return t.prototype.setState=function(t){return this.excuter=this.eventStates[t],this},t.prototype.excute=function(t){this.excuter&&this.excuter.excute(this.context,t)},t}(),rt=function(){function t(){}return t.prototype.excute=function(t,e){var i,r,o=t._calcMousePos(e);t.mousedownPos=o;var a=t.inLineText(t.lines,o),s=t.getActiveLine(o);if(a&&"boolean"!=typeof a)t.activeLineText=a,t.handleTextClick();else if(s&&n.lineMode===N.HANDLER)t.activeLine=s,t.eventType=k.LINECLICK;else{if(t.activeHoverNode){var l=t.getHitAnchor(t.activeHoverNode,o);l?(t.eventType=k.ANCHORMATCH,t.activeAnchor=l,t.newLineID=c()):(null===(r=null===(i=t.activeHoverNode.table)||void 0===i?void 0:i.collapseRect)||void 0===r?void 0:r.hit(o))?t.eventType=k.NODECOLLAPSE:t.eventType=k.NODECLICK}else t.eventType=k.CANVASCLICK,t.canvas.style.cursor="pointer";if(t.activeNode){var h=t.activeNode.hitResizer(o);void 0!==h&&h>=0&&(t.eventType=k.NODERESIZE,t.activeResizer=h,t.canvas.style.cursor=n.resizerCursors[h])}t.activeNode=t.getActiveNode(o)}if(t.activeLine){var u=t.getLineControl(t.activeLine,o);u&&(t.activeLineControl=u,t.eventType=k.LINECONTROLCLICK)}},t}(),ot=function(){function t(t){this.context=t,this.excuter=new rt}return t.prototype.excute=function(t){this.excuter.excute(this.context,t)},t}(),at=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},st=function(){function t(t,e){void 0===e&&(e={}),this.parentElem=t,this.options=e,this.canvas=document.createElement("canvas"),this.width=0,this.height=0,this.scaleRatio=1,this.eventType=k.NONE,this.nodes=[],this.lines=[],this.mousedownPos=new S(0,0),this.activeAnchor=new S(0,0),this.newLineID="",this.activeResizer=0,this.scrollTop=0,this.scrollLeft=0,this.padding=10,this.thumbnailScale=1,this.thumbnailActive=!1,this.ctx=this.canvas.getContext("2d"),n.thumbnail&&(this.thumbnail=document.createElement("canvas"),this.thumbnail.width=n.thumbnailW,this.thumbnail.height=n.thumbnailH,this.thumbnail.setAttribute("style","position: absolute; z-index: 3; bottom:15px; right: 15px;border: 3px solid rgba(192,192,192,0.5);border-radius: 3px;"),this.thumbnailCtx=this.thumbnail.getContext("2d"),this.parentElem.appendChild(this.thumbnail)),this.load(Object.assign({},D,e))}return t.prototype.load=function(t){var e=t.grid,i=t.data;this.grid=e,this.data=new z(i),this.nodes=this.data.nodes,this.lines=this.data.lines,this.initCanvasWH(),this.parentElem.appendChild(this.canvas),this.registerEventListeners(),n.thumbnail&&this.thumbnail&&this.registerThumbnailEventListeners(),this.render()},t.prototype.render=function(){var t=this;this.ctx&&(this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.grid&&function(t,e,i){var n=Math.max(e.width,e.height)/(i<1?i:1);if(t){t.save();for(var r=0;10*r<n;)t.strokeStyle=r%4?"#F8F8F8":"#EBEBEB",t.beginPath(),t.moveTo(10*r-.5,-.5),t.lineTo(10*r-.5,n-.5+50),t.stroke(),++r;for(r=0;10*r<n;)t.strokeStyle=r%4?"#F8F8F8":"#EBEBEB",t.beginPath(),t.moveTo(-.5,10*r-.5),t.lineTo(n-.5+50,10*r-.5),t.stroke(),++r;t.restore()}}(this.ctx,this.canvas,this.scaleRatio),this.ctx.translate(-this.scrollLeft,-this.scrollTop),this.ctx.scale(this.scaleRatio,this.scaleRatio),B(this.ctx,this.nodes),this.lines.forEach((function(e){e.hidden(t.nodes)||(n.lineMode===N.ANCHOR&&e.updateEndPoints(t.nodes),t.ctx&&e.draw(t.ctx))})),this.ctx.restore(),n.thumbnail&&function(t){if(t.thumbnailCtx&&t.thumbnail){t.thumbnailCtx.save(),t.thumbnailCtx.fillStyle=n.thumbnailFillBg,t.thumbnailCtx.fillRect(0,0,t.thumbnail.width,t.thumbnail.height);var e=t.thumbnailScale=Math.min(n.thumbnailW/t.width,n.thumbnailH/t.height);t.thumbnailCtx.scale(e,e),t.thumbnailCtx.drawImage(t.canvas,t.scrollLeft,t.scrollTop,t.width,t.height,0,0,t.width,t.height),t.thumbnailCtx.restore()}}(this))},t.prototype.registerEventListeners=function(){var t,e,i=this._registerListener();for(var n in i){var r=Array.isArray(i[n])?i[n]:[i[n]];try{for(var o=(t=void 0,at(r)),a=o.next();!a.done;a=o.next()){var s=a.value;this.canvas.addEventListener(n,s.fn)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}}},t.prototype.registerThumbnailEventListeners=function(){var t,e;if(this.thumbnail){var i=this._registerThumbnailListener();for(var n in i){var r=Array.isArray(i[n])?i[n]:[i[n]];try{for(var o=(t=void 0,at(r)),a=o.next();!a.done;a=o.next()){var s=a.value;this.thumbnail.addEventListener(n,s.fn)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}}}},t.prototype.removeListener=function(t,e){var i,n;for(var r in console.log(e),t){var o=Array.isArray(t[r])?t[r]:[t[r]];try{for(var a=(i=void 0,at(o)),s=a.next();!s.done;s=a.next()){var c=s.value;c.el.removeEventListener(r,c.fn)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}}},t.prototype.initCanvasWH=function(){this.width=this.canvas.width=this.parentElem.clientWidth/this.scaleRatio,this.height=this.canvas.height=this.parentElem.clientHeight/this.scaleRatio,this.parentElem.setAttribute("style","width:"+this.width+"px;height:"+this.height+"px")},t.prototype.resize=function(t){this.width=t.width,this.height=t.height,this.parentElem.setAttribute("style","width:"+this.width+"px;height:"+this.height+"px"),this.updateCanvasWH(),this.render()},t.prototype.updateCanvasWH=function(){var t=this.nodes.filter((function(t){return!t.parent})),e=0,i=0;t.forEach((function(t){e=Math.max(e,t.rect.x+t.rect.w),i=Math.max(i,t.rect.y+t.rect.h)})),this.canvas.width=Math.max(this.width,e),this.canvas.height=Math.max(this.height,i)},t.prototype._calcMousePos=function(t){var e=this.canvas.getBoundingClientRect();return new S((t.x-e.x+this.scrollLeft)/this.scaleRatio,(t.y-e.y+this.scrollTop)/this.scaleRatio)},t.prototype.getActiveHoverNode=function(t,e){e&&e.updateNodeAnchorStatus(!0);var i=this.inNode(this.nodes,t);if(i)return e?(i.key===e.key||(e.updateNodeAnchorStatus(!0),i.updateNodeAnchorStatus(!1)),i):(i.updateNodeAnchorStatus(!1),i)},t.prototype.getActiveNode=function(t){if(this.eventType===k.NODERESIZE)return this.activeNode;var e=this.inNode(this.nodes,t);return e&&this.activeNode?e.key===this.activeNode.key?this.activeNode:e:this.activeNode||e},t.prototype.getLineControl=function(t,e){return t.from.hit(e,n.anchorRadius)?t.from:t.to.hit(e,n.anchorRadius)?t.to:void 0},t.prototype.getHitAnchor=function(t,e){if(t.anchors)return t.anchors.find((function(t){return t.hit(e,n.anchorRadius)}))},t.prototype.inNode=function(t,e){for(var i,n=t.length-1;n>=0;n--)if(!t[n].table.hidden&&o(e,t[n].toPoints())){i=t[n];break}if(i){var r=i.getChildNode(this.nodes);return this.inNode(r,e)||i}return i},t.prototype.inLineText=function(t,e){var i=t.find((function(t){var i=t.toTextPoints();return!!i&&o(e,i)}));return i||!1},t.prototype.addNode=function(t){this.data.locked||(this.nodes.push(new M(t)),this.render())},t.prototype.getActiveLine=function(t){return this.lines.find((function(e){return e.pointIn(t)}))},t.prototype.updateNodeActive=function(t){this.nodes.forEach((function(e){e.active=!!t&&t.key===e.key}))},t.prototype.updateLineActive=function(t){this.lines.forEach((function(e){e.active=!!t&&t.id===e.id}))},t.prototype.addLine=function(t){if(!this.data.locked){var e=this.lines.find((function(e){return e.id===t.id}));e?Object.assign(e,t):this.lines.push(new E(t)),this.render()}},t.prototype.calcScrollDistance=function(t){this.scrollLeft-t.x<=0?this.scrollLeft=0:this.scrollLeft-t.x>=this.canvas.width-this.width?this.scrollLeft=this.canvas.width-this.width:this.scrollLeft-=t.x,this.scrollTop-t.y<=0?this.scrollTop=0:this.scrollTop-t.y>=this.canvas.height-this.height?this.scrollTop=this.canvas.height-this.height:this.scrollTop-=t.y},t.prototype.removeInvalidLine=function(){var t=this;this.lines.splice(this.lines.findIndex((function(e){return e.id===t.newLineID})),1),this.render()},t.prototype.calcDelta=function(t,e){return{x:Number(((t.x-e.x)*this.scaleRatio).toPrecision(1)),y:Number(((t.y-e.y)*this.scaleRatio).toPrecision(1))}},t.prototype.handleDblClick=function(){return this.activeHoverNode},t.prototype.handleTextClick=function(){return this.activeLineText},t.prototype.getParentNode=function(t,e){for(var i,n=t.length-1;n>=0;n--)if(!t[n].table.hidden&&o(e,t[n].toPoints())){i=t[n];break}return i},t.prototype.handleDragover=function(t){var e=new S((t.offsetX+this.scrollLeft)/this.scaleRatio,(t.offsetY+this.scrollTop)/this.scaleRatio),i=this.getParentNode(this.nodes.filter((function(t){return t.table.isGroup})),e);return i?{key:c(),parent:i.key,rect:{x:i.rect.x,y:i.rect.y+i.table.titleRect.h,w:n.tableDefaultW,h:n.tableDefaultH}}:{key:c(),rect:{x:e.x,y:e.y,w:n.tableDefaultW,h:n.tableDefaultH}}},t.prototype._registerListener=function(){var t,e=this,i=new Y(this),n=new nt(this),r=new ot(this);return(t={mousedown:{fn:function(t){r.excute(t)}},mousemove:{fn:function(t){n.setState(e.eventType).excute(t)}},mouseup:{fn:function(t){i.setState(e.eventType).excute(t).reset()}},dblclick:{fn:function(t){var i,n,r=e._calcMousePos(t);e.activeHoverNode&&(null===(n=null===(i=e.activeHoverNode.table)||void 0===i?void 0:i.titleRect)||void 0===n?void 0:n.hit(r))&&(e.eventType=k.NODEDBLCLICK,e.handleDblClick()),e.eventType=k.NONE}}})["object"==typeof window.onmousewheel?"mousewheel":"DOMMouseScroll"]={fn:function(t){if(t.deltaY<0)e.scaleRatio=Number((e.scaleRatio+.1).toPrecision(1));else{var i=Number((e.scaleRatio-.1).toPrecision(1));e.scaleRatio=i<.5?.5:i}e.render()}},t},t.prototype._registerThumbnailListener=function(){var t=this;return{mousedown:{fn:function(){t.thumbnail&&(t.thumbnail.style.cursor="pointer",t.thumbnailActive=!0)}},mousemove:{fn:function(e){t.thumbnailActive&&(t.calcScrollDistance({x:Number((e.movementX*t.scaleRatio/t.thumbnailScale).toPrecision(1)),y:Number((e.movementY*t.scaleRatio/t.thumbnailScale).toPrecision(1))}),t.render())}},mouseup:{fn:function(){t.thumbnail&&(t.thumbnail.style.cursor="default",t.thumbnailActive=!1)}}}},t}(),ct=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),lt=function(t){function e(e,i,n){void 0===i&&(i={});var r=t.call(this,e,i)||this;return r.fns=n,r}return ct(e,t),e.prototype.handleDblClick=function(){var e=t.prototype.handleDblClick.call(this);return this.fns.dblclick(e),e},e.prototype.handleTextClick=function(){var e=t.prototype.handleTextClick.call(this);return this.fns.textclick(e),e},e}(st);function ht(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function ut(){return ht()+ht()+"-"+ht()+"-"+ht()+"-"+ht()+"-"+ht()+ht()+ht()}},function(t,e,i){"use strict";var n,r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},o=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),a=[];function s(t){for(var e=-1,i=0;i<a.length;i++)if(a[i].identifier===t){e=i;break}return e}function c(t,e){for(var i={},n=[],r=0;r<t.length;r++){var o=t[r],c=e.base?o[0]+e.base:o[0],l=i[c]||0,h="".concat(c," ").concat(l);i[c]=l+1;var u=s(h),f={css:o[1],media:o[2],sourceMap:o[3]};-1!==u?(a[u].references++,a[u].updater(f)):a.push({identifier:h,updater:x(f,e),references:1}),n.push(h)}return n}function l(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var r=i.nc;r&&(n.nonce=r)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var a=o(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var h,u=(h=[],function(t,e){return h[t]=e,h.filter(Boolean).join("\n")});function f(t,e,i,n){var r=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=u(e,r);else{var o=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function y(t,e,i){var n=i.css,r=i.media,o=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var d=null,p=0;function x(t,e){var i,n,r;if(e.singleton){var o=p++;i=d||(d=l(e)),n=f.bind(null,i,o,!1),r=f.bind(null,i,o,!0)}else i=l(e),n=y.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var i=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<i.length;n++){var r=s(i[n]);a[r].references--}for(var o=c(t,e),l=0;l<i.length;l++){var h=s(i[l]);0===a[h].references&&(a[h].updater(),a.splice(h,1))}i=o}}}},function(t,e,i){(e=i(5)(!1)).push([t.i,"#_2YzdkUyx1k0p2m4NxmHgbr{display:flex;flex:1;overflow:hidden;height:100%;min-width:1000px;min-height:500px}#_2YzdkUyx1k0p2m4NxmHgbr #_1kMt4GVfD7TJJVLHbvHh7R{display:flex;flex:1;background:#ffffff;overflow:hidden}#_2YzdkUyx1k0p2m4NxmHgbr #_1kMt4GVfD7TJJVLHbvHh7R #_2VFzkjNexIwn69JXbZAHZX{width:100%;height:100%;margin:auto;overflow:hidden}\n",""]),e.locals={diagramPage:"_2YzdkUyx1k0p2m4NxmHgbr",diagramMain:"_1kMt4GVfD7TJJVLHbvHh7R",canvas:"_2VFzkjNexIwn69JXbZAHZX"},t.exports=e},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var r=(a=n,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),o=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[i].concat(o).concat([r]).join("\n")}var a,s,c;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,n){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(n)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(r[a]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);n&&r[c[0]]||(i&&(c[2]?c[2]="".concat(i," and ").concat(c[2]):c[2]=i),e.push(c))}},e}},function(t,e,i){"use strict";i.r(e);var n=i(0),r=i.n(n);
/**
  * vue-class-component v7.2.5
  * (c) 2015-present Evan You
  * @license MIT
  */
function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(){return"undefined"!=typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function l(t,e){h(t,e),Object.getOwnPropertyNames(e.prototype).forEach((function(i){h(t.prototype,e.prototype,i)})),Object.getOwnPropertyNames(e).forEach((function(i){h(t,e,i)}))}function h(t,e,i){(i?Reflect.getOwnMetadataKeys(e,i):Reflect.getOwnMetadataKeys(e)).forEach((function(n){var r=i?Reflect.getOwnMetadata(n,e,i):Reflect.getOwnMetadata(n,e);i?Reflect.defineMetadata(n,r,t,i):Reflect.defineMetadata(n,r,t)}))}var u={__proto__:[]}instanceof Array;function f(t,e){var i=e.prototype._init;e.prototype._init=function(){var e=this,i=Object.getOwnPropertyNames(t);if(t.$options.props)for(var n in t.$options.props)t.hasOwnProperty(n)||i.push(n);i.forEach((function(i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){t[i]=e},configurable:!0})}))};var n=new e;e.prototype._init=i;var r={};return Object.keys(n).forEach((function(t){void 0!==n[t]&&(r[t]=n[t])})),r}var y=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.name=e.name||t._componentTag||t.name;var i=t.prototype;Object.getOwnPropertyNames(i).forEach((function(t){if("constructor"!==t)if(y.indexOf(t)>-1)e[t]=i[t];else{var n=Object.getOwnPropertyDescriptor(i,t);void 0!==n.value?"function"==typeof n.value?(e.methods||(e.methods={}))[t]=n.value:(e.mixins||(e.mixins=[])).push({data:function(){return a({},t,n.value)}}):(n.get||n.set)&&((e.computed||(e.computed={}))[t]={get:n.get,set:n.set})}})),(e.mixins||(e.mixins=[])).push({data:function(){return f(this,t)}});var n=t.__decorators__;n&&(n.forEach((function(t){return t(e)})),delete t.__decorators__);var o=Object.getPrototypeOf(t.prototype),s=o instanceof r.a?o.constructor:r.a,h=s.extend(e);return x(h,t,s),c()&&l(h,t),h}var p={prototype:!0,arguments:!0,callee:!0,caller:!0};function x(t,e,i){Object.getOwnPropertyNames(e).forEach((function(n){if(!p[n]){var r=Object.getOwnPropertyDescriptor(t,n);if(!r||r.configurable){var a,s,c=Object.getOwnPropertyDescriptor(e,n);if(!u){if("cid"===n)return;var l=Object.getOwnPropertyDescriptor(i,n);if(a=c.value,s=o(a),null!=a&&("object"===s||"function"===s)&&l&&l.value===c.value)return}0,Object.defineProperty(t,n,c)}}}))}function v(t){return"function"==typeof t?d(t):function(e){return d(e,t)}}v.registerHooks=function(t){y.push.apply(y,s(t))};var m=v;"undefined"!=typeof Reflect&&Reflect.getMetadata;var b,w=i(1),g=i.n(w),L=i(2),R=(b=function(t,e){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}b(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),N=function(t,e,i,n){var r,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,i,a):r(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ergRenderer=null,e.ergData={nodes:[{key:"9999",rect:{x:10,y:320,w:200,h:200},table:{}},{key:"0",rect:{x:10,y:10,w:150,h:150},table:{isGroup:!1,name:"A_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}},{key:1,rect:{x:400,y:10,w:400,h:200},table:{isGroup:!0,name:"B_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}},{key:2,parent:1,rect:{x:420,y:100,w:100,h:100},table:{isGroup:!1,name:"C_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}},{key:3,parent:1,rect:{x:550,y:50,w:150,h:150},table:{isGroup:!0,name:"D_table"}},{key:4,parent:3,rect:{x:560,y:90,w:100,h:100},table:{isGroup:!1,name:"E_table",fields:[{name:"CustId",primaryKey:!0},{name:"CustName",primaryKey:!1},{name:"CustName",primaryKey:!1}]}}],lines:[{from:{id:"0",anchorIndex:2},to:{id:"9999",anchorIndex:0},text:"text"}]},e}return R(e,t),e.prototype.dblclick=function(t){alert(JSON.stringify(t))},e.prototype.textclick=function(t){alert(JSON.stringify(t))},e.prototype.mounted=function(){var t=document.getElementById(g.a.canvas);t&&(this.ergRenderer=new L.Diagram(t,{data:this.ergData},{dblclick:this.dblclick,textclick:this.textclick}))},e.prototype.render=function(t){return t("div",{attrs:{id:g.a.diagramPage}},[t("div",{attrs:{id:g.a.diagramMain}},[t("div",{attrs:{id:g.a.canvas},ref:"canvas"})])])},e=N([m({name:"DiagramComponent"})],e)}(r.a);e.default=P}])}));