!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){window,t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function o(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}i.r(e),i.d(e,"uuid",(function(){return o}))}])},,,function(t,e,i){"use strict";i.r(e),i.d(e,"Diagram",(function(){return ht}));var n={fontColor:"#000000",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"left",textBaseline:"top",textRectFill:"#ffffff",textRectStroke:"#000000",textRectActiveStroke:"#E79D32",lineMode:1,lineJoin:"miter",lineWidth:2,lineStroke:"#000000",lineActiveStroke:"#E79D32",arrowFill:"#000000",arrowStroke:"#000000",arrowActiveFill:"#E79D32",arrowActiveStroke:"#E79D32",defaultLineName:"polyline",defaultFromArrowType:"",defaultToArrowType:"triangleSolid",tableName:"双击",tableDefaultW:100,tableDefaultH:100,tableHandle:1,tableNodeFill:"#ffffff",tableNodeStroke:"#c1c7cd",tableNodeBorderColor:"#0C64EB",tablePadding:10,tableTitleFill:"#e1e7ed",tableGroupTitleFill:"#d0e2ff",tablePrimarykeyFill:"#fffaf1",anchorRadius:5,anchorFill:"#ffffff",anchorStroke:"#ff0000",resizerStroke:"#0C64EB",resizerFill:"#ffffff",resizerWidth:10,resizerCursors:["nw-resize","ne-resize","se-resize","sw-resize"],thumbnail:!1,thumbnailW:240,thumbnailH:140,thumbnailFillBg:"#ffffff",thumbnailFillRect:"rgba(0,0,0,0.2)"},o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function r(t,e){var i,n;if(e.length<3)return!1;var r=!1,s=e[e.length-1];try{for(var c=o(e),a=c.next();!a.done;a=c.next()){var h=a.value;(h.y<t.y&&s.y>=t.y||h.y>=t.y&&s.y<t.y)&&h.x+(t.y-h.y)*(s.x-h.x)/(s.y-h.y)>t.x&&(r=!r),s=h}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}return r}function s(t,e,i){return r(t,[new P(e.x-8,e.y-8),new P(i.x-8,i.y-8),new P(i.x+8,i.y+8),new P(e.x+8,e.y+8)])}var c=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function a(t,e){var i,o;t.strokeStyle=e.active?n.lineActiveStroke:n.lineStroke,t.beginPath(),t.moveTo(e.from.x,e.from.y);try{for(var r=c(e.controlPoints),s=r.next();!s.done;s=r.next()){var a=s.value;t.lineTo(a.x,a.y)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}t.lineTo(e.to.x,e.to.y),t.stroke()}function h(t,e){t.save(),t.fillStyle="#fff",t.strokeStyle=e.active?n.lineActiveStroke:n.lineStroke,t.lineWidth=2,l(t,e.from),l(t,e.to),t.restore()}function l(t,e){t.beginPath(),t.arc(e.x,e.y,n.anchorRadius,0,2*Math.PI),t.stroke(),t.fill()}function u(t){t.controlPoints=[];var e=y(t.from,t.to);void 0!==t.from.direction&&t.controlPoints.push(e);var i=y(t.to,t.from),n=[];switch(e.direction){case w.Up:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y>e.y)return e.direction===w.Up&&t.y-e.y>150?t.x<e.x?e.x-t.x<50?[new P(t.x-100,t.y),new P(t.x-100,e.y)]:[new P(t.x,e.y)]:t.x-e.x<50?[new P(t.x+100,t.y),new P(t.x+100,e.y)]:[new P(t.x,e.y)]:e.direction===w.Left&&t.x>e.x||e.direction===w.Right&&t.x<e.x?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===w.Bottom){if(t.x<e.x)return d(t,e);var i=d(e,t);return[i[1],i[0]]}return[new P(e.x,t.y)]}(e,i);break;case w.Right:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x<e.x)return e.direction===w.Right&&e.x-t.x>150?t.y<e.y?e.y-t.y<50?[new P(t.x,t.y-100),new P(e.x,t.y-100)]:[new P(e.x,t.y)]:t.y-e.y<50?[new P(t.x,t.y+100),new P(e.x,t.y+100)]:[new P(e.x,t.y)]:e.direction===w.Right||e.direction===w.Up&&t.y<e.y||e.direction===w.Bottom&&t.y>e.y?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===w.Left){if(t.y<e.y)return p(t,e);var i=p(e,t);return[i[1],i[0]]}return[new P(t.x,e.y)]}(e,i);break;case w.Bottom:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y<e.y)return e.direction===w.Bottom&&e.y-t.y>150?t.x<e.x?e.x-t.x<50?[new P(t.x-100,t.y),new P(t.x-100,e.y)]:[new P(t.x,e.y)]:t.x-e.x<50?[new P(t.x+100,t.y),new P(t.x+100,e.y)]:[new P(t.x,e.y)]:e.direction===w.Left&&t.x>e.x||e.direction===w.Right&&t.x<e.x?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===w.Up){if(t.x<e.x)return d(t,e);var i=d(e,t);return[i[1],i[0]]}return[new P(e.x,t.y)]}(e,i);break;case w.Left:n=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x>e.x)return e.direction===w.Left&&t.x-e.x>150?t.y<e.y?e.y-t.y<50?[new P(t.x,t.y+100),new P(e.x,t.y+100)]:[new P(e.x,t.y)]:t.y-e.y<50?[new P(t.x,t.y-100),new P(e.x,t.y-100)]:[new P(e.x,t.y)]:e.direction===w.Left||e.direction===w.Up&&t.y<e.y||e.direction===w.Bottom&&t.y>e.y?[new P(e.x,t.y)]:[new P(t.x,e.y)];if(e.direction===w.Right){if(t.y<e.y)return p(t,e);var i=p(e,t);return[i[1],i[0]]}return[new P(t.x,e.y)]}(e,i)}t.controlPoints.push.apply(t.controlPoints,n),void 0!==t.to.direction&&t.controlPoints.push(i)}function f(t,e){if(!e.controlPoints||!e.controlPoints.length)return s(t,e.from,e.to);if(s(t,e.from,e.controlPoints[0]))return!0;if(s(t,e.to,e.controlPoints[e.controlPoints.length-1]))return!0;for(var i=0;i<e.controlPoints.length-1;++i)if(s(t,e.controlPoints[i],e.controlPoints[i+1]))return!0;return!1}function y(t,e){var i=t.clone();switch(t.direction){case w.Up:e.y<t.y?i.y-=Math.floor((t.y-e.y)/2):i.y-=50;break;case w.Right:e.x>t.x?i.x+=Math.floor((e.x-t.x)/2):i.x+=50;break;case w.Bottom:e.y>t.y?i.y+=Math.floor((e.y-t.y)/2):i.y+=50;break;case w.Left:e.x<t.x?i.x-=Math.floor((t.x-e.x)/2):i.x-=50}return i}function d(t,e){var i=t.x+(e.x-t.x)/2;return[new P(i,t.y),new P(i,e.y)]}function p(t,e){var i=t.y+(e.y-t.y)/2;return[new P(t.x,i),new P(e.x,i)]}function x(t,e,i,n,o){n+=3*t.lineWidth;var r=t.lineWidth/10;t.lineWidth<2&&(t.lineWidth=2,r=0),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x-t.lineWidth+5*r,-i.y),t.moveTo(i.x,i.y+r),t.lineTo(i.x,i.y-r),t.lineTo(i.x-n,i.y-n/3),t.lineTo(i.x-n,i.y+n/3),t.closePath(),t.stroke(),o&&(t.fillStyle=o),t.fill()}function v(t,e,i,n){x(t,e,i,n,"#fff")}var m={},b={};m.polyline={drawFn:a,controlPointsFn:u,drawEndPointsFn:h,pointIn:f},b.triangleSolid=x,b.triangle=v;var w,g,L,R,N=i(0),P=function(){function t(t,e,i,n,o,r){void 0===r&&(r=0),this.x=t,this.y=e,this.direction=i,this.id=n,this.hidden=o,this.anchorIndex=r,this.id=n,this.direction=i,this.anchorIndex=i||0,this.hidden=o||!1}return t.prototype.clone=function(){return new t(this.x,this.y,this.direction)},t.prototype.floor=function(){this.x|=0,this.y|=0},t.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},t.prototype.hit=function(t,e){return void 0===e&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},t.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,n=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=n,this},t.prototype.getLinkNode=function(t){var e=this;return t.find((function(t){return t.key===e.id}))},t.prototype.updateDirection=function(t){this.direction=t,this.anchorIndex=t},t}(),S=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},C=function(){function t(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n,this.center=new P(0,0),i<0&&(i=0),n<0&&(n=0),this.init()}return t.prototype.init=function(){this.ex=this.x+this.w,this.ey=this.y+this.h,this.calcCenter()},t.prototype.floor=function(){this.x|=0,this.y|=0,this.w|=0,this.h|=0,this.init()},t.prototype.round=function(){this.x=Math.round(this.x),this.y=Math.round(this.y),this.w=Math.round(this.w),this.h=Math.round(this.h),this.init()},t.prototype.clone=function(){return new t(this.x,this.y,this.w,this.h)},t.prototype.hit=function(t,e){return void 0===e&&(e=0),t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},t.prototype.hitByRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},t.prototype.hitRotate=function(t,e,i){var n,o,s=this.toPoints();try{for(var c=S(s),a=c.next();!a.done;a=c.next()){a.value.rotate(e,i)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}return r(t,s)},t.prototype.calcCenter=function(){this.center.x=this.x+this.w/2,this.center.y=this.y+this.h/2},t.prototype.toPoints=function(){return[new P(this.x,this.y),new P(this.ex,this.y),new P(this.ex,this.ey),new P(this.x,this.ey)]},t.prototype.translate=function(t,e){this.x+=t,this.y+=e,this.ex+=t,this.ey+=e,this.calcCenter()},t.prototype.scale=function(t,e,i){e||(e=this.center),void 0===i&&(i=t),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*i,this.w*=t,this.h*=i,this.init()},t}();!function(t){t[t.Up=0]="Up",t[t.Right=1]="Right",t[t.Bottom=2]="Bottom",t[t.Left=3]="Left"}(w||(w={})),function(t){t[t.LeftTop=0]="LeftTop",t[t.RightTop=1]="RightTop",t[t.RightBottom=2]="RightBottom",t[t.LeftBottom=3]="LeftBottom"}(g||(g={})),function(t){t[t.ANCHOR=0]="ANCHOR",t[t.HANDLER=1]="HANDLER"}(L||(L={})),function(t){t[t.COLLAPSE=0]="COLLAPSE",t[t.SWITCH=1]="SWITCH"}(R||(R={}));var A,T=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},E=function(){function t(t){var e,i;if(this.controlPoints=[],this.fromArrowSize=5,this.toArrowSize=5,this.active=!1,this.animatePos=0,this.isAnimate=!1,this.animateFromSize=0,this.animateToSize=0,t){if(t.from&&(this.from=t.from),t.to&&(this.to=t.to),this.id=t.id||Object(N.uuid)(),this.name=t.name||n.defaultLineName,this.fromArrow=t.fromArrow||n.defaultFromArrowType,this.toArrow=t.toArrow||n.defaultToArrowType,this.calcControlPoints(),t.controlPoints)try{for(var o=T(t.controlPoints),r=o.next();!r.done;r=o.next()){var s=r.value;this.controlPoints.push(new P(s.x,s.y,s.direction))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}this.animateColor=t.animateColor||"",this.animateSpan=t.animateSpan||1,this.text=t.text}else this.name=n.defaultLineName,this.fromArrow=n.defaultToArrowType}return t.prototype.calcTextRect=function(){var t=this.getCenter(),e=n.lineHeight*n.fontSize;this.textRect=new C(t.x-25,t.y-e/2,50,e)},t.prototype.getTextRect=function(){return this.textRect||this.calcTextRect(),this.textRect},t.prototype.pointIn=function(t){return m[this.name].pointIn(t,this)},t.prototype.toTextPoints=function(){return!!this.textRect&&[new P(this.textRect.x,this.textRect.y),new P(this.textRect.x+this.textRect.w,this.textRect.y),new P(this.textRect.x+this.textRect.w,this.textRect.y+this.textRect.h),new P(this.textRect.x,this.textRect.y+this.textRect.h)]},t.prototype.getCenter=function(){var t=new P(this.from.x,this.from.y),e=Math.floor(this.controlPoints.length/2);switch(this.name){case"polyline":t=this.getLineCenter(this.controlPoints[e-1],this.controlPoints[e])}return t},t.prototype.getLineCenter=function(t,e){return new P((t.x+e.x)/2,(t.y+e.y)/2)},t.prototype._drawText=function(t){this.getTextRect(),t&&this.text&&this.textRect&&(t.save(),t.fillStyle=n.textRectFill,t.strokeStyle=this.active?n.textRectActiveStroke:n.textRectStroke,t.fillRect(this.textRect.x,this.textRect.y,this.textRect.w,this.textRect.h),t.strokeRect(this.textRect.x,this.textRect.y,this.textRect.w,this.textRect.h),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(this.text,this.textRect.x+(this.textRect.w-t.measureText(this.text).width)/2,this.textRect.y+(this.textRect.h-n.fontSize)/2),t.restore())},t.prototype.calcControlPoints=function(){this.from&&this.to&&m[this.name]&&m[this.name].controlPointsFn(this)},t.prototype.draw=function(t){n.lineMode===L.HANDLER&&this.calcControlPoints(),this.isAnimate||(t.save(),t.lineJoin=n.lineJoin,t.lineWidth=n.lineWidth,m[this.name]&&m[this.name].drawFn(t,this),t.restore());if(this.fromArrow&&b[this.fromArrow]){t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.active?n.arrowActiveFill:n.arrowFill,t.strokeStyle=this.active?n.arrowActiveStroke:n.arrowStroke;var e=this.to;e=this.controlPoints[0],b[this.fromArrow](t,e,this.from,1*this.fromArrowSize),t.restore()}if(this.toArrow&&b[this.toArrow]){t.save(),t.beginPath(),t.lineDashOffset=0,t.setLineDash([]),t.fillStyle=this.active?n.arrowActiveFill:n.arrowFill,t.strokeStyle=this.active?n.arrowActiveStroke:n.arrowStroke;e=this.from;e=this.controlPoints[this.controlPoints.length-1],b[this.toArrow](t,e,this.to,1*this.toArrowSize),t.restore()}n.lineMode===L.HANDLER&&this.active&&m[this.name].drawEndPointsFn(t,this),this.text&&!this.isAnimate&&(this.calcTextRect(),this._drawText(t))},t.prototype.getLineToDirection=function(t){var e=this.controlPoints[this.controlPoints.length-1];return t.y>e.y?w.Up:t.y<e.y?w.Bottom:t.x>e.x?w.Left:t.x<e.x?w.Right:void 0},t.prototype.hidden=function(t){var e=this,i=t.find((function(t){return t.key===e.from.id})),n=t.find((function(t){return t.key===e.to.id}));return!(!(null==i?void 0:i.table.hidden)&&!(null==n?void 0:n.table.hidden))},t.prototype.getPointByPos=function(t){var e,i;if(t<=0)return this.from;switch(this.name){case"polyline":if(this.controlPoints&&this.controlPoints.length){var n=this.controlPoints.concat(this.to),o=this.from;try{for(var r=T(n),s=r.next();!s.done;s=r.next()){var c=s.value,a=this.lineLen(o,c);if(!(t>a))return this.getLinePtByPos(o,c,t);t-=a,o=c}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return this.to}return this.getLinePtByPos(this.from,this.to,t)}return null},t.prototype.getLinePtByPos=function(t,e,i){var n=this.lineLen(t,e);if(i<=0)return t;if(i>=n)return e;var o=t.x+(e.x-t.x)*(i/n),r=t.y+(e.y-t.y)*(i/n);return new P(o,r)},t.prototype.round=function(){this.from.round(),this.to.round()},t.prototype.lineLen=function(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},t.prototype.translate=function(t,e){var i,n;this.from.x+=t,this.from.y+=e,this.to.x+=t,this.to.y+=e;try{for(var o=T(this.controlPoints),r=o.next();!r.done;r=o.next()){var s=r.value;s.x+=t,s.y+=e}}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},t.prototype.updateEndPoints=function(t){this.from=this.updateEndPoint(t,this.from),this.to=this.updateEndPoint(t,this.to),this.calcControlPoints()},t.prototype.updateEndPoint=function(t,e){var i=t.find((function(t){return t.key===e.id}));return i?i.anchors[e.anchorIndex]:e},t.prototype._calcPosition=function(t,e,i){var n=e.toRect();t.direction===w.Bottom||t.direction===w.Up?(t.x+=i.x,t.x>n.ex&&(t.x=n.ex,t.y=n.y+n.h/2,t.updateDirection(w.Right)),t.x<n.x&&(t.x=n.x,t.y=n.y+n.h/2,t.updateDirection(w.Left))):(t.y+=i.y,t.y>n.ey&&(t.y=n.ey,t.x=n.x+n.w/2,t.updateDirection(w.Bottom)),t.y<n.y&&(t.y=n.y,t.x=n.x+n.w/2,t.updateDirection(w.Up)))},t.prototype.lineMove=function(t,e,i){this._calcPosition(this.from,t,i),this._calcPosition(this.to,e,i)},t.prototype.lineEndMove=function(t,e,i){var n=e.toRect();t.direction===w.Bottom||t.direction===w.Up?(t.x+=i.x,t.x>n.ex&&(t.x=n.ex,t.updateDirection(w.Right)),t.x<n.x&&(t.x=n.x,t.updateDirection(w.Left))):(t.y+=i.y,t.y>n.ey&&(t.y=n.ey,t.updateDirection(w.Bottom)),t.y<n.y&&(t.y=n.y,t.updateDirection(w.Up)))},t}(),k=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s},O=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(k(arguments[e]));return t},H=function(){function t(t){this.key=t.key,this.parent=t.parent,this.rect=t.rect,this.padding=t.padding||n.tablePadding,this.fontSize=t.fontSize||n.fontSize,this.table=t.table,this.table.collapse=t.table.collapse||!1,this.table.hidden=t.table.hidden||!1,this.table.name=t.table.name||n.tableName,this.table.titleRect=new C(this.rect.x+.5,this.rect.y+.5,this.table.isGroup?this.rect.w-(this.fontSize+2*this.padding):this.rect.w-.5,this.fontSize+2*this.padding),this.table.collapseRect=this.table.isGroup?new C(this.rect.x+this.rect.w-this.fontSize-2*this.padding,this.rect.y+.5,this.fontSize+2*this.padding,this.fontSize+2*this.padding):null,this.alias=t.alias||"",this.active=t.active||!1,this.anchors=t.anchors||this.calcAnchors()}return t.prototype.toPoints=function(){return[new P(this.rect.x,this.rect.y),new P(this.rect.x+this.rect.w,this.rect.y),new P(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h)),new P(this.rect.x,this.rect.y+(n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h))]},t.prototype.toRect=function(){return new C(this.rect.x,this.rect.y,this.rect.w,n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h)},t.prototype.translate=function(t,e){var i=this;this.rect.x+=t.x,this.rect.y+=t.y,this.calcAnchors(),n.lineMode===L.HANDLER&&e&&e.forEach((function(e){e.from.id===i.key&&(e.from.x+=t.x,e.from.y+=t.y),e.to.id===i.key&&(e.to.x+=t.x,e.to.y+=t.y)}))},t.prototype.calcResizer=function(){var t=[];return t.push(new P(this.rect.x,this.rect.y,g.LeftTop,this.key)),t.push(new P(this.rect.x+this.rect.w,this.rect.y,g.RightTop,this.key)),t.push(new P(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),g.RightBottom,this.key)),t.push(new P(this.rect.x,this.rect.y+(n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),g.LeftBottom,this.key)),t},t.prototype.hitResizer=function(t){if(this.active)return this.calcResizer().findIndex((function(e){return e.hit(t,n.resizerWidth/2)}))},t.prototype.resize=function(t,e,i,o){var r=this;if(0!==n.tableHandle||!this.table.collapse)if(this.rect.h<this.table.titleRect.h)this.rect.h=this.table.titleRect.h;else{var s=this.getParentNode(t);switch(e){case g.LeftTop:s?(this.resizeFromParent(s,i,w.Left),this.resizeFromParent(s,i,w.Up)):(this.rect.x+=i.x,this.rect.y+=i.y,this.rect.w-=i.x,this.rect.h-=i.y);break;case g.RightTop:s?(this.resizeFromParent(s,i,w.Right),this.resizeFromParent(s,i,w.Up)):(this.rect.y+=i.y,this.rect.w+=i.x,this.rect.h-=i.y);break;case g.RightBottom:s?(this.resizeFromParent(s,i,w.Right),this.resizeFromParent(s,i,w.Bottom)):(this.rect.w+=i.x,this.rect.h+=i.y);break;case g.LeftBottom:s?(this.resizeFromParent(s,i,w.Left),this.resizeFromParent(s,i,w.Bottom)):(this.rect.x+=i.x,this.rect.w-=i.x,this.rect.h+=i.y)}this.calcAnchors(),n.lineMode===L.HANDLER&&o&&o.forEach((function(t){t.from.id===r.key&&r._calcLinePosition(t.from),t.to.id===r.key&&r._calcLinePosition(t.to)}))}},t.prototype.resizeFromParent=function(t,e,i){switch(i){case w.Left:this.rect.x+e.x<=t.rect.x?this.rect.x=t.rect.x:(this.rect.x+=e.x,this.rect.w-=e.x);break;case w.Up:this.rect.y+e.y<=t.rect.y+t.table.titleRect.h?this.rect.y=t.rect.y+t.table.titleRect.h:(this.rect.y+=e.y,this.rect.h-=e.y);break;case w.Right:this.rect.x+this.rect.w+e.x>=t.rect.x+t.rect.w||(this.rect.w+=e.x);break;case w.Bottom:this.rect.y+this.rect.h+e.y>=t.rect.y+t.rect.h||(this.rect.h+=e.y)}},t.prototype._calcLinePosition=function(t){t.direction!==w.Bottom&&t.direction!==w.Up||(t.y=t.direction===w.Bottom?this.rect.y+this.rect.h:this.rect.y,t.x<this.rect.x&&(t.x=this.rect.x),t.x>this.rect.x+this.rect.w&&(t.x=this.rect.x+this.rect.w)),t.direction!==w.Left&&t.direction!==w.Right||(t.x=t.direction===w.Left?this.rect.x:this.rect.x+this.rect.w,t.y<this.rect.y&&(t.y=this.rect.y),t.y>this.rect.y+this.rect.h&&(t.y=this.rect.y+this.rect.h))},t.prototype.calcAnchors=function(){return this.anchors=[],this.anchors.push(new P(this.rect.x+this.rect.w/2,this.rect.y,w.Up,this.key)),this.anchors.push(new P(this.rect.x+this.rect.w,this.rect.y+(n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h/2:this.rect.h/2),w.Right,this.key)),this.anchors.push(new P(this.rect.x+this.rect.w/2,this.rect.y+(n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h:this.rect.h),w.Bottom,this.key)),this.anchors.push(new P(this.rect.x,this.rect.y+(n.tableHandle===R.COLLAPSE&&this.table.collapse?this.table.titleRect.h/2:this.rect.h/2),w.Left,this.key)),this.anchors},t.prototype.getChildNode=function(t){var e=this;return t.filter((function(t){return t.parent===e.key}))},t.prototype.getGenerations=function(t){var e=[],i=function(n){var o=n.getChildNode(t);o&&(e.push.apply(e,O(o)),o.forEach((function(t){return i(t)})))};return i(this),e},t.prototype.getParentNode=function(t){var e=this;return t.find((function(t){return t.key===e.parent}))},t.prototype.outBounds=function(t,e){var i=this.table.collapse?this.table.titleRect:this.rect,n=this.getParentNode(t);return!!n&&(i.x+i.w+e.x>=n.rect.x+n.rect.w||i.x+e.x<=n.rect.x||i.y+e.y<=n.rect.y+n.table.titleRect.h||i.y+i.h+e.y>=n.rect.y+n.rect.h)},t.prototype.updateNodeAnchorStatus=function(t){for(var e=0;e<this.anchors.length;++e)this.anchors[e].hidden=t},t}();!function(t){t.NONE="None",t.NODEHOVER="NodeHover",t.NODECLICK="NodeClick",t.NODERESIZE="NodeResize",t.NODEDBLCLICK="NodeDblClick",t.NODECOLLAPSE="NodeCollapse",t.ANCHORMATCH="AnchorMatch",t.LINECLICK="LineClick",t.LINETEXTCLICK="LineTextClick",t.LINECONTROLCLICK="LineControlClick",t.CANVASCLICK="CanvasClick"}(A||(A={}));var D={grid:!0,font:{color:n.fontColor,fontFamily:n.fontFamily,fontSize:n.fontSize,lineHeight:n.lineHeight,textAlign:n.textAlign,textBaseline:n.textBaseline}},M=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},z=function(){function t(t){var e,i,o,r;if(this.nodes=[],this.lines=[],t){this.nodes=[];try{for(var s=M(t.nodes),c=s.next();!c.done;c=s.next()){var a=c.value;this.nodes.push(new H(a))}}catch(t){e={error:t}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}this.lines=[];try{for(var h=M(t.lines),l=h.next();!l.done;l=h.next()){!(a=l.value).from||a.from instanceof P||(a.from=this.translateLineOptionToPoint(this.nodes,a.from)),!a.to||a.to instanceof P||(a.to=this.translateLineOptionToPoint(this.nodes,a.to)),this.lines.push(new E(a))}}catch(t){o={error:t}}finally{try{l&&!l.done&&(r=h.return)&&r.call(h)}finally{if(o)throw o.error}}this.lineName=t.lineName||n.defaultLineName,this.fromArrowType=t.fromArrowType||n.defaultFromArrowType,this.toArrowType=t.toArrowType||n.defaultToArrowType,this.scale=t.scale||1,this.locked=t.locked||0}}return t.prototype.translateLineOptionToPoint=function(t,e){var i=t.find((function(t){return t.key===e.id}));return i?i.anchors[e.anchorIndex]:e},t}();function B(t,e,i){var n=t.measureText(e).width,o=t.measureText("…").width;if(n<=i||i<=o)return e;for(var r=e.length;n>=i-o&&r-- >0;)e=e.slice(0,r),n=t.measureText(e).width;return e+"…"}function I(t,e){e.forEach((function(e){!e.table.hidden&&function(t,e){if(t){t.save();var i=Number(e.rect.w)||100,o=Number(e.rect.h)||50,r=Number(e.rect.x),s=Number(e.rect.y);t.strokeStyle=e.active?n.resizerStroke:n.tableNodeStroke,t.fillStyle=n.tableNodeFill,function(t){var e=t.ctx,i=t.x,n=t.y,o=t.width,r=t.height,s=t.r,c=t.fill,a=t.stroke,h=t.multichamber,l=t.shadow;if(e.save(),e.beginPath(),h)for(var u=0;u++<2;)e.moveTo(i+3*u,n-3*(u-1)),e.arcTo(i+3*u,n-3*u,i+s+3*u,n-3*u,s),e.arcTo(i+o+3*u,n-3*u,i+o+3*u,n+s-3*u,s),e.arcTo(i+o+3*u,n+r-3*u,i+o-s+3*u,n+r-3*u,s),!s&&e.lineTo(i+o-s+3*(u-1),n+r-3*u);e.moveTo(i+s,n),e.arcTo(i+o,n,i+o,n+s,s),e.arcTo(i+o,n+r,i+o-s,n+r,s),e.arcTo(i,n+r,i,n+r-s,s),e.arcTo(i,n,i+s,n,s),l&&(e.shadowColor="#B0B0B0",e.shadowBlur=8,e.shadowOffsetX=3,e.shadowOffsetY=3),c&&e.fill(),a&&e.stroke(),e.restore()}({ctx:t,x:r+.5,y:s+.5,width:i,height:n.tableHandle===R.COLLAPSE&&e.table.collapse?e.table.titleRect.h:o,r:0,fill:!0,stroke:!0,multichamber:!1,shadow:!0}),function(t,e,i,o,r){t&&e.padding&&e.fontSize&&(t.save(),t.fillStyle=e.table.isGroup?n.tableGroupTitleFill:n.tableTitleFill,t.fillRect(e.table.titleRect.x,e.table.titleRect.y,e.table.titleRect.w,e.table.titleRect.h),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(B(t,e.table.name,i-14),o+e.padding,r+e.padding),t.restore())}(t,e,i,r,s),e.table.isGroup&&e.table.collapseRect&&function(t,e){t&&e.table.collapseRect&&(t.save(),t.fillStyle=e.table.isGroup?n.tableGroupTitleFill:n.tableTitleFill,t.fillRect(e.table.collapseRect.x,e.table.collapseRect.y,e.table.collapseRect.w,e.table.collapseRect.h),t.restore())}(t,e),n.tableHandle===R.COLLAPSE?!e.table.fields||e.table.collapse||e.table.isGroup||F(t,e,i,r,s):n.tableHandle===R.SWITCH&&e.table.fields&&e.table.isGroup===e.table.collapse&&F(t,e,i,r,s),e.active&&function(t,e){if(e.table.hidden)return;for(var i=e.calcResizer(),o=0;o<i.length;++o)t.save(),t.strokeStyle=n.resizerStroke,t.fillStyle=n.resizerFill,t.beginPath(),t.fillRect(i[o].x-n.resizerWidth/2,i[o].y-n.resizerWidth/2,n.resizerWidth,n.resizerWidth),t.strokeRect(i[o].x-n.resizerWidth/2,i[o].y-n.resizerWidth/2,n.resizerWidth,n.resizerWidth),t.fill(),t.stroke(),t.restore()}(t,e),t.restore()}}(t,new H(e))}))}function F(t,e,i,o,r){var s=n.tablePadding,c=n.fontSize*n.lineHeight;t&&(t.save(),e.table.fields&&e.table.fields.forEach((function(a,h){r+(h+2)*c+s<=e.rect.y+e.rect.h&&(a.primaryKey&&(t.fillStyle=n.tablePrimarykeyFill,t.fillRect(o+1,r+(h+1)*c+s+.5,i-1,c)),t.beginPath(),t.strokeStyle=n.tableNodeStroke,t.moveTo(o+.5,r+(h+1)*c+s+.5),t.lineTo(o+i+.5,r+(h+1)*c+s+.5),t.stroke(),t.font=n.fontSize+"px "+n.fontFamily,t.fillStyle=n.fontColor,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline,t.fillText(B(t,a.name,i-2*s),s+o,r+n.fontSize+2*s+h*c))})),t.restore())}var _,j=function(){function t(){}return t.prototype.excute=function(t){t.activeNode&&(t.updateNodeActive(t.activeNode),t.updateCanvasWH(),t.render())},t}(),W=function(){function t(){}return t.prototype.excute=function(t){t.updateNodeActive(),t.updateLineActive(),t.render()},t}(),K=function(){function t(){}return t.prototype.excute=function(t){t.updateNodeActive(),t.updateLineActive(),t.render()},t}(),U=function(){function t(){}return t.prototype.excute=function(t){t.updateLineActive(t.activeLine),t.render()},t}(),G=function(){function t(){}return t.prototype.excute=function(t){t.handleTextClick()},t}(),X=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e);if(t.activeHoverNode){if(n.lineMode===L.ANCHOR){var o=t.getHitAnchor(t.activeHoverNode,i);o?t.addLine({id:t.newLineID,from:t.activeAnchor,to:o,text:"inner"}):t.removeInvalidLine()}else if(n.lineMode===L.HANDLER){var r=t.lines.find((function(e){return e.id===t.newLineID})),s=null==r?void 0:r.getLineToDirection(i);void 0!==s&&s>=0&&t.addLine({id:t.newLineID,from:t.activeAnchor,to:t.activeHoverNode.anchors[s],text:"inner"})}}else t.removeInvalidLine()},t}(),V=function(){function t(){}return t.prototype.excute=function(t){t.activeHoverNode&&(!function(t,e){e.table.collapse=!e.table.collapse,e.calcAnchors();var i=e.getGenerations(t);i&&i.forEach((function(e){var i=e.getParentNode(t);i&&(e.table.hidden=i.table.collapse||i.table.hidden)}))}(t.nodes,t.activeHoverNode),t.render())},t}(),Y=function(){function t(t){var e;this.context=t,this.eventStates=((e={})[A.NONE]=new W,e[A.NODECLICK]=new j,e[A.CANVASCLICK]=new K,e[A.LINECLICK]=new U,e[A.LINETEXTCLICK]=new G,e[A.ANCHORMATCH]=new X,e[A.NODECOLLAPSE]=new V,e)}return t.prototype.setState=function(t){return this.excuter=this.eventStates[t],this},t.prototype.excute=function(t){return this.excuter&&this.excuter.excute(this.context,t),this},t.prototype.reset=function(){this.context.eventType=A.NONE},t}(),Z=(_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),J=function(){function t(){}return t.prototype.excute=function(t,e){if(t.activeNode){var i=t._calcMousePos(e),o=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,!t.activeNode.outBounds(t.nodes,o)){var r;if(n.lineMode===L.HANDLER)t.activeNode.translate(o,t.lines),(r=t.activeNode.getGenerations(t.nodes))&&r.forEach((function(e){e.translate(o,t.lines)}));else t.activeNode.translate(o),(r=t.activeNode.getGenerations(t.nodes))&&r.forEach((function(t){t.translate(o)}));t.render()}}},t}(),q=function(){function t(){}return t.prototype.excute=function(t,e){var i,o,r=t._calcMousePos(e);if(t.inLineText(t.lines,r))t.canvas.style.cursor="pointer";else if(n.lineMode===L.HANDLER&&t.getActiveLine(r)&&t.eventType!==A.ANCHORMATCH)t.canvas.style.cursor="move";else if(t.activeHoverNode=t.getActiveHoverNode(r,t.activeHoverNode),t.activeHoverNode?(t.getHitAnchor(t.activeHoverNode,r)?t.canvas.style.cursor="crosshair":(null===(o=null===(i=t.activeHoverNode.table)||void 0===i?void 0:i.collapseRect)||void 0===o?void 0:o.hit(r))?t.canvas.style.cursor="pointer":t.canvas.style.cursor="move",t.render(),t.ctx&&function(t,e,i,o,r){if(!e.table.hidden){e.calcAnchors();for(var s=0;s<e.anchors.length;++s)e.anchors[s].hidden||(t.save(),t.strokeStyle=n.anchorStroke,t.fillStyle=n.anchorFill,t.beginPath(),t.arc(e.anchors[s].x*i-o,e.anchors[s].y*i-r,n.anchorRadius,0,2*Math.PI),t.fill(),t.stroke(),t.restore())}}(t.ctx,t.activeHoverNode,t.scaleRatio,t.scrollLeft,t.scrollTop)):(t.canvas.style.cursor="default",t.render()),t.activeNode){var s=t.activeNode.hitResizer(r);void 0!==s&&s>=0&&(t.canvas.style.cursor=n.resizerCursors[s])}t.activeLine&&(t.getLineControl(t.activeLine,r)&&(t.canvas.style.cursor="pointer"))},t}(),Q=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);t.mousedownPos=i,t.calcScrollDistance(n),t.render()},t}(),$=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,t.activeLine){var o=t.activeLine.from.getLinkNode(t.nodes),r=t.activeLine.to.getLinkNode(t.nodes);o&&r&&n&&t.activeLine.lineMove(o,r,n),t.render()}},t}(),tt=function(){function t(){}return t.prototype.excute=function(t,e){if(t.activeNode){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);t.mousedownPos=i,t.activeNode.resize(t.nodes,t.activeResizer,n,t.lines),t.render()}},t}(),et=function(){function t(){}return t.prototype.excute=function(t,e){var i=t._calcMousePos(e),n=t.calcDelta(i,t.mousedownPos);if(t.mousedownPos=i,t.activeLineControl&&t.activeLine){var o=t.activeLineControl.getLinkNode(t.nodes);o&&(t.activeLine.lineEndMove(t.activeLineControl,o,n),t.render())}},t}(),it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Z(e,t),e.prototype.excute=function(e,i){e.addLine({id:e.newLineID,from:e.activeAnchor,to:e._calcMousePos(i)}),t.prototype.excute.call(this,e,i)},e}(q),nt=function(){function t(t){var e;this.context=t,this.eventStates=((e={})[A.NONE]=new q,e[A.NODECLICK]=new J,e[A.CANVASCLICK]=new Q,e[A.LINECLICK]=new $,e[A.ANCHORMATCH]=new it,e[A.NODERESIZE]=new tt,e[A.LINECONTROLCLICK]=new et,e)}return t.prototype.setState=function(t){return this.excuter=this.eventStates[t],this},t.prototype.excute=function(t){this.excuter&&this.excuter.excute(this.context,t)},t}(),ot=function(){function t(){}return t.prototype.excute=function(t,e){var i,o,r=t._calcMousePos(e);t.mousedownPos=r;var s=t.inLineText(t.lines,r),c=t.getActiveLine(r);if(s&&"boolean"!=typeof s)t.activeLineText=s,t.eventType=A.LINETEXTCLICK;else if(c&&n.lineMode===L.HANDLER)t.activeLine=c,t.eventType=A.LINECLICK;else{if(t.activeHoverNode){var a=t.getHitAnchor(t.activeHoverNode,r);a?(t.eventType=A.ANCHORMATCH,t.activeAnchor=a,t.newLineID=Object(N.uuid)()):(null===(o=null===(i=t.activeHoverNode.table)||void 0===i?void 0:i.collapseRect)||void 0===o?void 0:o.hit(r))?t.eventType=A.NODECOLLAPSE:t.eventType=A.NODECLICK}else t.eventType=A.CANVASCLICK,t.canvas.style.cursor="pointer";if(t.activeNode){var h=t.activeNode.hitResizer(r);void 0!==h&&h>=0&&(t.eventType=A.NODERESIZE,t.activeResizer=h,t.canvas.style.cursor=n.resizerCursors[h])}t.activeNode=t.getActiveNode(r)}if(t.activeLine){var l=t.getLineControl(t.activeLine,r);l&&(t.activeLineControl=l,t.eventType=A.LINECONTROLCLICK)}},t}(),rt=function(){function t(t){this.context=t,this.excuter=new ot}return t.prototype.excute=function(t){this.excuter.excute(this.context,t)},t}(),st=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ct=function(){function t(t,e){void 0===e&&(e={}),this.parentElem=t,this.options=e,this.canvas=document.createElement("canvas"),this.width=0,this.height=0,this.scaleRatio=1,this.eventType=A.NONE,this.nodes=[],this.lines=[],this.mousedownPos=new P(0,0),this.activeAnchor=new P(0,0),this.newLineID="",this.activeResizer=0,this.scrollTop=0,this.scrollLeft=0,this.padding=10,this.thumbnailScale=1,this.thumbnailActive=!1,this.ctx=this.canvas.getContext("2d"),n.thumbnail&&(this.thumbnail=document.createElement("canvas"),this.thumbnail.width=n.thumbnailW,this.thumbnail.height=n.thumbnailH,this.thumbnail.setAttribute("style","position: absolute; z-index: 3; bottom:15px; right: 15px;border: 3px solid rgba(192,192,192,0.5);border-radius: 3px;"),this.thumbnailCtx=this.thumbnail.getContext("2d"),this.parentElem.appendChild(this.thumbnail)),this.load(Object.assign({},D,e))}return t.prototype.load=function(t){var e=t.grid,i=t.data;this.grid=e,this.data=new z(i),this.nodes=this.data.nodes,this.lines=this.data.lines,this.initCanvasWH(),this.parentElem.appendChild(this.canvas),this.registerEventListeners(),n.thumbnail&&this.thumbnail&&this.registerThumbnailEventListeners(),this.render()},t.prototype.render=function(){var t=this;this.ctx&&(this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.grid&&function(t,e,i){var n=Math.max(e.width,e.height)/(i<1?i:1);if(t){t.save();for(var o=0;10*o<n;)t.strokeStyle=o%4?"#F8F8F8":"#EBEBEB",t.beginPath(),t.moveTo(10*o-.5,-.5),t.lineTo(10*o-.5,n-.5+50),t.stroke(),++o;for(o=0;10*o<n;)t.strokeStyle=o%4?"#F8F8F8":"#EBEBEB",t.beginPath(),t.moveTo(-.5,10*o-.5),t.lineTo(n-.5+50,10*o-.5),t.stroke(),++o;t.restore()}}(this.ctx,this.canvas,this.scaleRatio),this.ctx.translate(-this.scrollLeft,-this.scrollTop),this.ctx.scale(this.scaleRatio,this.scaleRatio),I(this.ctx,this.nodes),this.lines.forEach((function(e){e.hidden(t.nodes)||(n.lineMode===L.ANCHOR&&e.updateEndPoints(t.nodes),t.ctx&&e.draw(t.ctx))})),this.ctx.restore(),n.thumbnail&&function(t){if(t.thumbnailCtx&&t.thumbnail){t.thumbnailCtx.save(),t.thumbnailCtx.fillStyle=n.thumbnailFillBg,t.thumbnailCtx.fillRect(0,0,t.thumbnail.width,t.thumbnail.height);var e=t.thumbnailScale=Math.min(n.thumbnailW/t.width,n.thumbnailH/t.height);t.thumbnailCtx.scale(e,e),t.thumbnailCtx.drawImage(t.canvas,t.scrollLeft,t.scrollTop,t.width,t.height,0,0,t.width,t.height),t.thumbnailCtx.restore()}}(this))},t.prototype.registerEventListeners=function(){var t,e,i=this._registerListener();for(var n in i){var o=Array.isArray(i[n])?i[n]:[i[n]];try{for(var r=(t=void 0,st(o)),s=r.next();!s.done;s=r.next()){var c=s.value;this.canvas.addEventListener(n,c.fn)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}},t.prototype.registerThumbnailEventListeners=function(){var t,e;if(this.thumbnail){var i=this._registerThumbnailListener();for(var n in i){var o=Array.isArray(i[n])?i[n]:[i[n]];try{for(var r=(t=void 0,st(o)),s=r.next();!s.done;s=r.next()){var c=s.value;this.thumbnail.addEventListener(n,c.fn)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}}},t.prototype.removeListener=function(t,e){var i,n;for(var o in console.log(e),t){var r=Array.isArray(t[o])?t[o]:[t[o]];try{for(var s=(i=void 0,st(r)),c=s.next();!c.done;c=s.next()){var a=c.value;a.el.removeEventListener(o,a.fn)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}}},t.prototype.initCanvasWH=function(){this.width=this.canvas.width=this.parentElem.clientWidth/this.scaleRatio,this.height=this.canvas.height=this.parentElem.clientHeight/this.scaleRatio,this.parentElem.setAttribute("style","width:"+this.width+"px;height:"+this.height+"px")},t.prototype.resize=function(t){this.width=t.width,this.height=t.height,this.parentElem.setAttribute("style","width:"+this.width+"px;height:"+this.height+"px"),this.updateCanvasWH(),this.render()},t.prototype.updateCanvasWH=function(){var t=this.nodes.filter((function(t){return!t.parent})),e=0,i=0;t.forEach((function(t){e=Math.max(e,t.rect.x+t.rect.w),i=Math.max(i,t.rect.y+t.rect.h)})),this.canvas.width=Math.max(this.width,e),this.canvas.height=Math.max(this.height,i)},t.prototype._calcMousePos=function(t){var e=this.canvas.getBoundingClientRect();return new P((t.x-e.x+this.scrollLeft)/this.scaleRatio,(t.y-e.y+this.scrollTop)/this.scaleRatio)},t.prototype.getActiveHoverNode=function(t,e){e&&e.updateNodeAnchorStatus(!0);var i=this.inNode(this.nodes,t);if(i)return e?(i.key===e.key||(e.updateNodeAnchorStatus(!0),i.updateNodeAnchorStatus(!1)),i):(i.updateNodeAnchorStatus(!1),i)},t.prototype.getActiveNode=function(t){if(this.eventType===A.NODERESIZE)return this.activeNode;var e=this.inNode(this.nodes,t);return e&&this.activeNode?e.key===this.activeNode.key?this.activeNode:e:this.activeNode||e},t.prototype.getLineControl=function(t,e){return t.from.hit(e,n.anchorRadius)?t.from:t.to.hit(e,n.anchorRadius)?t.to:void 0},t.prototype.getHitAnchor=function(t,e){if(t.anchors)return t.anchors.find((function(t){return t.hit(e,n.anchorRadius)}))},t.prototype.inNode=function(t,e){for(var i,n=t.length-1;n>=0;n--)if(!t[n].table.hidden&&r(e,t[n].toPoints())){i=t[n];break}if(i){var o=i.getChildNode(this.nodes);return this.inNode(o,e)||i}return i},t.prototype.inLineText=function(t,e){var i=t.find((function(t){var i=t.toTextPoints();return!!i&&r(e,i)}));return i||!1},t.prototype.addNode=function(t){this.data.locked||(this.nodes.push(new H(t)),this.render())},t.prototype.getActiveLine=function(t){return this.lines.find((function(e){return e.pointIn(t)}))},t.prototype.updateNodeActive=function(t){this.nodes.forEach((function(e){e.active=!!t&&t.key===e.key}))},t.prototype.updateLineActive=function(t){this.lines.forEach((function(e){e.active=!!t&&t.id===e.id}))},t.prototype.addLine=function(t){if(!this.data.locked){var e=this.lines.find((function(e){return e.id===t.id}));e?Object.assign(e,t):this.lines.push(new E(t)),this.render()}},t.prototype.calcScrollDistance=function(t){this.scrollLeft-t.x<=0?this.scrollLeft=0:this.scrollLeft-t.x>=this.canvas.width-this.width?this.scrollLeft=this.canvas.width-this.width:this.scrollLeft-=t.x,this.scrollTop-t.y<=0?this.scrollTop=0:this.scrollTop-t.y>=this.canvas.height-this.height?this.scrollTop=this.canvas.height-this.height:this.scrollTop-=t.y},t.prototype.removeInvalidLine=function(){var t=this;this.lines.splice(this.lines.findIndex((function(e){return e.id===t.newLineID})),1),this.render()},t.prototype.calcDelta=function(t,e){return{x:Number(((t.x-e.x)*this.scaleRatio).toPrecision(1)),y:Number(((t.y-e.y)*this.scaleRatio).toPrecision(1))}},t.prototype.handleDblClick=function(){return this.activeHoverNode},t.prototype.handleTextClick=function(){return this.activeLineText},t.prototype.getParentNode=function(t,e){for(var i,n=t.length-1;n>=0;n--)if(!t[n].table.hidden&&r(e,t[n].toPoints())){i=t[n];break}return i},t.prototype.handleDragover=function(t){var e=new P((t.offsetX+this.scrollLeft)/this.scaleRatio,(t.offsetY+this.scrollTop)/this.scaleRatio),i=this.getParentNode(this.nodes.filter((function(t){return t.table.isGroup})),e);return i?{key:Object(N.uuid)(),parent:i.key,rect:{x:i.rect.x,y:i.rect.y+i.table.titleRect.h,w:n.tableDefaultW,h:n.tableDefaultH}}:{key:Object(N.uuid)(),rect:{x:e.x,y:e.y,w:n.tableDefaultW,h:n.tableDefaultH}}},t.prototype._registerListener=function(){var t,e=this,i=new Y(this),n=new nt(this),o=new rt(this);return(t={mousedown:{fn:function(t){o.excute(t)}},mousemove:{fn:function(t){n.setState(e.eventType).excute(t)}},mouseup:{fn:function(t){i.setState(e.eventType).excute(t).reset()}},dblclick:{fn:function(t){var i,n,o=e._calcMousePos(t);e.activeHoverNode&&(null===(n=null===(i=e.activeHoverNode.table)||void 0===i?void 0:i.titleRect)||void 0===n?void 0:n.hit(o))&&(e.eventType=A.NODEDBLCLICK,e.handleDblClick()),e.eventType=A.NONE}}})["object"==typeof window.onmousewheel?"mousewheel":"DOMMouseScroll"]={fn:function(t){if(t.deltaY<0)e.scaleRatio=Number((e.scaleRatio+.1).toPrecision(1));else{var i=Number((e.scaleRatio-.1).toPrecision(1));e.scaleRatio=i<.5?.5:i}e.render()}},t},t.prototype._registerThumbnailListener=function(){var t=this;return{mousedown:{fn:function(){t.thumbnail&&(t.thumbnail.style.cursor="pointer",t.thumbnailActive=!0)}},mousemove:{fn:function(e){t.thumbnailActive&&(t.calcScrollDistance({x:Number((e.movementX*t.scaleRatio/t.thumbnailScale).toPrecision(1)),y:Number((e.movementY*t.scaleRatio/t.thumbnailScale).toPrecision(1))}),t.render())}},mouseup:{fn:function(){t.thumbnail&&(t.thumbnail.style.cursor="default",t.thumbnailActive=!1)}}}},t}(),at=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ht=function(t){function e(e,i,n){void 0===i&&(i={});var o=t.call(this,e,i)||this;return o.fns=n,o}return at(e,t),e.prototype.handleDblClick=function(){var e=t.prototype.handleDblClick.call(this);return this.fns.dblclick(e),e},e.prototype.handleTextClick=function(){var e=t.prototype.handleTextClick.call(this);return this.fns.textclick(e),e},e}(ct)}])}));